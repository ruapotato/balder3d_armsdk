// Generated by HLC 4.2.5 (HL v4)
#define HLC_BOOT
#include <hlc.h>
#include <iron/object/ParticleSystem.h>
#include <kha/arrays/ByteArrayPrivate.h>
#include <iron/data/TSceneFormat.h>
#include <iron/Scene.h>
#include <iron/object/Particle.h>
extern iron__$Scene g$_iron_Scene;
#include <hl/natives.h>
extern hl_type t$iron_object_Particle;
void iron_object_Particle_new(iron__object__Particle,int);
int hl_types_ArrayObj_push(hl__types__ArrayObj,vdynamic*);
#include <iron/object/MeshObject.h>
#include <iron/object/Transform.h>
#include <kha/math/FastMatrix4.h>
#include <iron/math/Mat4.h>
#include <iron/object/Tilesheet.h>
#include <iron/data/TTilesheetData.h>
#include <iron/system/Time.h>
extern iron__math__$Mat4 g$_iron_math_Mat4;
extern hl_type t$iron_math_Vec4;
void iron_math_Vec4_new(iron__math__Vec4,float*,float*,float*,float*);
void iron_object_Transform_buildMatrix(iron__object__Transform);
extern iron__system__$Time g$_iron_system_Time;
void iron_object_ParticleSystem_updateGpu(iron__object__ParticleSystem,iron__object__MeshObject,iron__object__MeshObject);
#include <iron/data/Geometry.h>
#include <iron/data/MeshData.h>
void iron_object_ParticleSystem_setupGeomGpu(iron__object__ParticleSystem,iron__object__MeshObject,iron__object__MeshObject);
#include <iron/data/TVertexArray.h>
kha__arrays__ByteArrayPrivate kha_arrays__Float32Array_Float32Array_Impl___new(int);
double iron_object_ParticleSystem_fhash(iron__object__ParticleSystem,int);
int Std_random(int);
double Math_random(void);
void iron_data_Geometry_setupInstanced(iron__data__Geometry,kha__arrays__ByteArrayPrivate,int,int);
#include <iron/data/TParticleReference.h>
extern hl_type t$iron_math_Quat;
void iron_math_Quat_new(iron__math__Quat,float*,float*,float*,float*);
extern hl_type t$iron_math_Mat4;
void iron_math_Mat4_new(iron__math__Mat4,float,float,float,float,float,float,float,float,float,float,float,float,float,float,float,float);
hl__types__ArrayObj hl_types_ArrayObj_alloc(varray*);
extern hl_type t$fun_9cbeb3a;
void iron_data_Data_getParticle(String,String,vclosure*);

void iron_object_ParticleSystem_new__$1(iron__object__ParticleSystem r0,iron__data__ParticleData r1) {
	hl__types__ArrayObj r23;
	bool r25;
	iron__$Scene r8;
	iron__Scene r7;
	iron__data__ParticleData r2;
	iron__object__Particle r24;
	iron__data__TParticleData r3;
	kha__arrays__ByteArrayPrivate r5, r11, r16;
	iron__data__TSceneFormat r6;
	float r9, r13, r14, r18, r19;
	double r15, r20;
	int r12, r17, r21, r22;
	vbyte *r10;
	if( r0 == NULL ) hl_null_access();
	r0->data = r1;
	r2 = r0->data;
	if( r2 == NULL ) hl_null_access();
	r3 = r2->raw;
	r0->r = r3;
	r8 = (iron__$Scene)g$_iron_Scene;
	r7 = r8->active;
	if( r7 == NULL ) hl_null_access();
	r6 = r7->raw;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->gravity;
	if( !r5 ) goto label$f408df5_1_66;
	r8 = (iron__$Scene)g$_iron_Scene;
	r7 = r8->active;
	if( r7 == NULL ) hl_null_access();
	r6 = r7->raw;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->gravity;
	if( r5 == NULL ) hl_null_access();
	r10 = r5->self;
	r12 = r5->byteArrayOffset;
	r9 = hl_kinc_bytearray_getfloat32(r10,r12);
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r14 = r3->weight_gravity;
	r13 = r9 * r14;
	r15 = (double)r13;
	r0->gx = r15;
	r8 = (iron__$Scene)g$_iron_Scene;
	r7 = r8->active;
	if( r7 == NULL ) hl_null_access();
	r6 = r7->raw;
	if( r6 == NULL ) hl_null_access();
	r11 = r6->gravity;
	if( r11 == NULL ) hl_null_access();
	r10 = r11->self;
	r12 = r11->byteArrayOffset;
	r17 = 4;
	r12 = r12 + r17;
	r13 = hl_kinc_bytearray_getfloat32(r10,r12);
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r18 = r3->weight_gravity;
	r14 = r13 * r18;
	r15 = (double)r14;
	r0->gy = r15;
	r8 = (iron__$Scene)g$_iron_Scene;
	r7 = r8->active;
	if( r7 == NULL ) hl_null_access();
	r6 = r7->raw;
	if( r6 == NULL ) hl_null_access();
	r16 = r6->gravity;
	if( r16 == NULL ) hl_null_access();
	r10 = r16->self;
	r12 = r16->byteArrayOffset;
	r17 = 8;
	r12 = r12 + r17;
	r14 = hl_kinc_bytearray_getfloat32(r10,r12);
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r19 = r3->weight_gravity;
	r18 = r14 * r19;
	r15 = (double)r18;
	r0->gz = r15;
	goto label$f408df5_1_77;
	label$f408df5_1_66:
	r15 = 0.;
	r0->gx = r15;
	r15 = 0.;
	r0->gy = r15;
	r15 = -9.810000000000000497;
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r9 = r3->weight_gravity;
	r20 = (double)r9;
	r15 = r15 * r20;
	r0->gz = r15;
	label$f408df5_1_77:
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r5 = r3->object_align_factor;
	if( r5 == NULL ) hl_null_access();
	r10 = r5->self;
	r12 = r5->byteArrayOffset;
	r9 = hl_kinc_bytearray_getfloat32(r10,r12);
	r15 = (double)r9;
	r20 = 2.;
	r15 = r15 / r20;
	r0->alignx = r15;
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r11 = r3->object_align_factor;
	if( r11 == NULL ) hl_null_access();
	r10 = r11->self;
	r12 = r11->byteArrayOffset;
	r17 = 4;
	r12 = r12 + r17;
	r13 = hl_kinc_bytearray_getfloat32(r10,r12);
	r15 = (double)r13;
	r20 = 2.;
	r15 = r15 / r20;
	r0->aligny = r15;
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r16 = r3->object_align_factor;
	if( r16 == NULL ) hl_null_access();
	r10 = r16->self;
	r12 = r16->byteArrayOffset;
	r17 = 8;
	r12 = r12 + r17;
	r14 = hl_kinc_bytearray_getfloat32(r10,r12);
	r15 = (double)r14;
	r20 = 2.;
	r15 = r15 / r20;
	r0->alignz = r15;
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r18 = r3->lifetime;
	r15 = (double)r18;
	r12 = r0->frameRate;
	r20 = (double)r12;
	r15 = r15 / r20;
	r0->lifetime = r15;
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r18 = r3->frame_end;
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r19 = r3->frame_start;
	r18 = r18 - r19;
	r15 = (double)r18;
	r12 = r0->frameRate;
	r20 = (double)r12;
	r15 = r15 / r20;
	r0->animtime = r15;
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r18 = r3->frame_end;
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r19 = r3->frame_start;
	r18 = r18 - r19;
	r15 = (double)r18;
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r12 = r3->count;
	r20 = (double)r12;
	r15 = r15 / r20;
	r12 = r0->frameRate;
	r20 = (double)r12;
	r15 = r15 / r20;
	r0->spawnRate = r15;
	r12 = 0;
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r17 = r3->count;
	label$f408df5_1_155:
	if( r12 >= r17 ) goto label$f408df5_1_166;
	r21 = r12;
	++r12;
	if( r0 == NULL ) hl_null_access();
	r23 = r0->particles;
	if( r23 == NULL ) hl_null_access();
	r24 = (iron__object__Particle)hl_alloc_obj(&t$iron_object_Particle);
	iron_object_Particle_new(r24,r21);
	r22 = hl_types_ArrayObj_push(r23,((vdynamic*)r24));
	goto label$f408df5_1_155;
	label$f408df5_1_166:
	if( r0 == NULL ) hl_null_access();
	r25 = true;
	r0->ready = r25;
	return;
}

void iron_object_ParticleSystem_update(iron__object__ParticleSystem r0,iron__object__MeshObject r1,iron__object__MeshObject r2) {
	iron__data__TTilesheetData r70;
	iron__math__Quat r10;
	kha__math__FastMatrix4 r14, r21, r51;
	bool r4;
	iron__data__TParticleData r64;
	iron__math__Vec4 r9, r11, r12, r17, r20;
	iron__object__Transform r8;
	iron__math__$Mat4 r16;
	iron__object__Tilesheet r69;
	float r13, r18, r19, r22, r23, r24, r25, r26, r27, r28, r29, r30, r31, r32, r33, r34, r35, r36, r37, r38, r39, r40, r41, r42, r43, r44, r45, r46, r47, r48, r49, r50, r53, r54, r55, r56, r57, r58, r59, r61;
	iron__math__Mat4 r7, r15;
	double r5, r6, r52, r62, r63;
	iron__system__$Time r71;
	float *r65, *r66, *r67, *r68;
	int r60;
	r4 = r0->ready;
	if( !r4 ) goto label$f408df5_2_6;
	if( !r1 ) goto label$f408df5_2_6;
	r5 = r0->speed;
	r6 = 0.;
	if( r5 != r6 ) goto label$f408df5_2_7;
	label$f408df5_2_6:
	return;
	label$f408df5_2_7:
	if( r2 == NULL ) hl_null_access();
	r8 = r2->transform;
	if( r8 == NULL ) hl_null_access();
	r7 = r8->world;
	r9 = r0->ownerLoc;
	r10 = r0->ownerRot;
	r11 = r0->ownerScl;
	if( r9 == NULL ) hl_null_access();
	if( r7 == NULL ) hl_null_access();
	r14 = r7->self;
	if( r14 == NULL ) hl_null_access();
	r13 = r14->_30;
	r9->x = r13;
	r14 = r7->self;
	if( r14 == NULL ) hl_null_access();
	r13 = r14->_31;
	r9->y = r13;
	r14 = r7->self;
	if( r14 == NULL ) hl_null_access();
	r13 = r14->_32;
	r9->z = r13;
	r16 = (iron__math__$Mat4)g$_iron_math_Mat4;
	r12 = r16->helpVec;
	if( r12 == NULL ) hl_null_access();
	r14 = r7->self;
	if( r14 == NULL ) hl_null_access();
	r13 = r14->_00;
	r12->x = r13;
	r14 = r7->self;
	if( r14 == NULL ) hl_null_access();
	r13 = r14->_01;
	r12->y = r13;
	r14 = r7->self;
	if( r14 == NULL ) hl_null_access();
	r13 = r14->_02;
	r12->z = r13;
	r5 = 1.;
	r13 = (float)r5;
	r12->w = r13;
	if( r11 == NULL ) hl_null_access();
	r13 = r12->x;
	r18 = r12->x;
	r13 = r13 * r18;
	r18 = r12->y;
	r19 = r12->y;
	r18 = r18 * r19;
	r13 = r13 + r18;
	r18 = r12->z;
	r19 = r12->z;
	r18 = r18 * r19;
	r13 = r13 + r18;
	r5 = (double)r13;
	r5 = hl_math_sqrt(r5);
	r13 = (float)r5;
	r11->x = r13;
	r16 = (iron__math__$Mat4)g$_iron_math_Mat4;
	r17 = r16->helpVec;
	if( r17 == NULL ) hl_null_access();
	r14 = r7->self;
	if( r14 == NULL ) hl_null_access();
	r13 = r14->_10;
	r17->x = r13;
	r14 = r7->self;
	if( r14 == NULL ) hl_null_access();
	r13 = r14->_11;
	r17->y = r13;
	r14 = r7->self;
	if( r14 == NULL ) hl_null_access();
	r13 = r14->_12;
	r17->z = r13;
	r5 = 1.;
	r13 = (float)r5;
	r17->w = r13;
	r13 = r17->x;
	r18 = r17->x;
	r13 = r13 * r18;
	r18 = r17->y;
	r19 = r17->y;
	r18 = r18 * r19;
	r13 = r13 + r18;
	r18 = r17->z;
	r19 = r17->z;
	r18 = r18 * r19;
	r13 = r13 + r18;
	r5 = (double)r13;
	r5 = hl_math_sqrt(r5);
	r13 = (float)r5;
	r11->y = r13;
	r16 = (iron__math__$Mat4)g$_iron_math_Mat4;
	r20 = r16->helpVec;
	if( r20 == NULL ) hl_null_access();
	r14 = r7->self;
	if( r14 == NULL ) hl_null_access();
	r13 = r14->_20;
	r20->x = r13;
	r14 = r7->self;
	if( r14 == NULL ) hl_null_access();
	r13 = r14->_21;
	r20->y = r13;
	r14 = r7->self;
	if( r14 == NULL ) hl_null_access();
	r13 = r14->_22;
	r20->z = r13;
	r5 = 1.;
	r13 = (float)r5;
	r20->w = r13;
	r13 = r20->x;
	r18 = r20->x;
	r13 = r13 * r18;
	r18 = r20->y;
	r19 = r20->y;
	r18 = r18 * r19;
	r13 = r13 + r18;
	r18 = r20->z;
	r19 = r20->z;
	r18 = r18 * r19;
	r13 = r13 + r18;
	r5 = (double)r13;
	r5 = hl_math_sqrt(r5);
	r13 = (float)r5;
	r11->z = r13;
	r14 = r7->self;
	if( r14 == NULL ) hl_null_access();
	r13 = r14->_12;
	r18 = r14->_22;
	r19 = r14->_32;
	r22 = r14->_13;
	r23 = r14->_23;
	r24 = r14->_33;
	r25 = r14->_11;
	r26 = r18 * r24;
	r27 = r19 * r23;
	r26 = r26 - r27;
	r25 = r25 * r26;
	r26 = r14->_21;
	r27 = r13 * r24;
	r28 = r19 * r22;
	r27 = r27 - r28;
	r26 = r26 * r27;
	r25 = r25 - r26;
	r26 = r14->_31;
	r27 = r13 * r23;
	r28 = r18 * r22;
	r27 = r27 - r28;
	r26 = r26 * r27;
	r25 = r25 + r26;
	r26 = r14->_12;
	r27 = r14->_22;
	r28 = r14->_32;
	r29 = r14->_13;
	r30 = r14->_23;
	r31 = r14->_33;
	r32 = r14->_10;
	r33 = r27 * r31;
	r34 = r28 * r30;
	r33 = r33 - r34;
	r32 = r32 * r33;
	r33 = r14->_20;
	r34 = r26 * r31;
	r35 = r28 * r29;
	r34 = r34 - r35;
	r33 = r33 * r34;
	r32 = r32 - r33;
	r33 = r14->_30;
	r34 = r26 * r30;
	r35 = r27 * r29;
	r34 = r34 - r35;
	r33 = r33 * r34;
	r32 = r32 + r33;
	r33 = r14->_11;
	r34 = r14->_21;
	r35 = r14->_31;
	r36 = r14->_13;
	r37 = r14->_23;
	r38 = r14->_33;
	r39 = r14->_10;
	r40 = r34 * r38;
	r41 = r35 * r37;
	r40 = r40 - r41;
	r39 = r39 * r40;
	r40 = r14->_20;
	r41 = r33 * r38;
	r42 = r35 * r36;
	r41 = r41 - r42;
	r40 = r40 * r41;
	r39 = r39 - r40;
	r40 = r14->_30;
	r41 = r33 * r37;
	r42 = r34 * r36;
	r41 = r41 - r42;
	r40 = r40 * r41;
	r39 = r39 + r40;
	r40 = r14->_11;
	r41 = r14->_21;
	r42 = r14->_31;
	r43 = r14->_12;
	r44 = r14->_22;
	r45 = r14->_32;
	r46 = r14->_10;
	r47 = r41 * r45;
	r48 = r42 * r44;
	r47 = r47 - r48;
	r46 = r46 * r47;
	r47 = r14->_20;
	r48 = r40 * r45;
	r49 = r42 * r43;
	r48 = r48 - r49;
	r47 = r47 * r48;
	r46 = r46 - r47;
	r47 = r14->_30;
	r48 = r40 * r44;
	r49 = r41 * r43;
	r48 = r48 - r49;
	r47 = r47 * r48;
	r46 = r46 + r47;
	r47 = r14->_00;
	r47 = r47 * r25;
	r48 = r14->_01;
	r48 = r48 * r32;
	r47 = r47 - r48;
	r48 = r14->_02;
	r48 = r48 * r39;
	r47 = r47 + r48;
	r48 = r14->_03;
	r48 = r48 * r46;
	r47 = r47 - r48;
	r5 = (double)r47;
	r6 = 0.;
	if( !(r5 < r6) ) goto label$f408df5_2_239;
	r47 = r11->x;
	r47 = -r47;
	r11->x = r47;
	label$f408df5_2_239:
	r5 = 1.;
	r47 = r11->x;
	r6 = (double)r47;
	r5 = r5 / r6;
	r16 = (iron__math__$Mat4)g$_iron_math_Mat4;
	r15 = r16->helpMat;
	if( r15 == NULL ) hl_null_access();
	r21 = r15->self;
	if( r21 == NULL ) hl_null_access();
	r51 = r7->self;
	if( r51 == NULL ) hl_null_access();
	r47 = r51->_00;
	r6 = (double)r47;
	r6 = r6 * r5;
	r47 = (float)r6;
	r21->_00 = r47;
	r16 = (iron__math__$Mat4)g$_iron_math_Mat4;
	r15 = r16->helpMat;
	if( r15 == NULL ) hl_null_access();
	r21 = r15->self;
	if( r21 == NULL ) hl_null_access();
	r51 = r7->self;
	if( r51 == NULL ) hl_null_access();
	r47 = r51->_01;
	r6 = (double)r47;
	r6 = r6 * r5;
	r47 = (float)r6;
	r21->_01 = r47;
	r16 = (iron__math__$Mat4)g$_iron_math_Mat4;
	r15 = r16->helpMat;
	if( r15 == NULL ) hl_null_access();
	r21 = r15->self;
	if( r21 == NULL ) hl_null_access();
	r51 = r7->self;
	if( r51 == NULL ) hl_null_access();
	r47 = r51->_02;
	r6 = (double)r47;
	r6 = r6 * r5;
	r47 = (float)r6;
	r21->_02 = r47;
	r6 = 1.;
	r47 = r11->y;
	r52 = (double)r47;
	r6 = r6 / r52;
	r5 = r6;
	r16 = (iron__math__$Mat4)g$_iron_math_Mat4;
	r15 = r16->helpMat;
	if( r15 == NULL ) hl_null_access();
	r21 = r15->self;
	if( r21 == NULL ) hl_null_access();
	r51 = r7->self;
	if( r51 == NULL ) hl_null_access();
	r47 = r51->_10;
	r6 = (double)r47;
	r6 = r6 * r5;
	r47 = (float)r6;
	r21->_10 = r47;
	r16 = (iron__math__$Mat4)g$_iron_math_Mat4;
	r15 = r16->helpMat;
	if( r15 == NULL ) hl_null_access();
	r21 = r15->self;
	if( r21 == NULL ) hl_null_access();
	r51 = r7->self;
	if( r51 == NULL ) hl_null_access();
	r47 = r51->_11;
	r6 = (double)r47;
	r6 = r6 * r5;
	r47 = (float)r6;
	r21->_11 = r47;
	r16 = (iron__math__$Mat4)g$_iron_math_Mat4;
	r15 = r16->helpMat;
	if( r15 == NULL ) hl_null_access();
	r21 = r15->self;
	if( r21 == NULL ) hl_null_access();
	r51 = r7->self;
	if( r51 == NULL ) hl_null_access();
	r47 = r51->_12;
	r6 = (double)r47;
	r6 = r6 * r5;
	r47 = (float)r6;
	r21->_12 = r47;
	r6 = 1.;
	r47 = r11->z;
	r52 = (double)r47;
	r6 = r6 / r52;
	r5 = r6;
	r16 = (iron__math__$Mat4)g$_iron_math_Mat4;
	r15 = r16->helpMat;
	if( r15 == NULL ) hl_null_access();
	r21 = r15->self;
	if( r21 == NULL ) hl_null_access();
	r51 = r7->self;
	if( r51 == NULL ) hl_null_access();
	r47 = r51->_20;
	r6 = (double)r47;
	r6 = r6 * r5;
	r47 = (float)r6;
	r21->_20 = r47;
	r16 = (iron__math__$Mat4)g$_iron_math_Mat4;
	r15 = r16->helpMat;
	if( r15 == NULL ) hl_null_access();
	r21 = r15->self;
	if( r21 == NULL ) hl_null_access();
	r51 = r7->self;
	if( r51 == NULL ) hl_null_access();
	r47 = r51->_21;
	r6 = (double)r47;
	r6 = r6 * r5;
	r47 = (float)r6;
	r21->_21 = r47;
	r16 = (iron__math__$Mat4)g$_iron_math_Mat4;
	r15 = r16->helpMat;
	if( r15 == NULL ) hl_null_access();
	r21 = r15->self;
	if( r21 == NULL ) hl_null_access();
	r51 = r7->self;
	if( r51 == NULL ) hl_null_access();
	r47 = r51->_22;
	r6 = (double)r47;
	r6 = r6 * r5;
	r47 = (float)r6;
	r21->_22 = r47;
	r16 = (iron__math__$Mat4)g$_iron_math_Mat4;
	r15 = r16->helpMat;
	if( r15 == NULL ) hl_null_access();
	r21 = r15->self;
	if( r21 == NULL ) hl_null_access();
	r47 = r21->_00;
	r21 = r15->self;
	if( r21 == NULL ) hl_null_access();
	r48 = r21->_10;
	r21 = r15->self;
	if( r21 == NULL ) hl_null_access();
	r49 = r21->_20;
	r21 = r15->self;
	if( r21 == NULL ) hl_null_access();
	r50 = r21->_01;
	r21 = r15->self;
	if( r21 == NULL ) hl_null_access();
	r53 = r21->_11;
	r21 = r15->self;
	if( r21 == NULL ) hl_null_access();
	r54 = r21->_21;
	r21 = r15->self;
	if( r21 == NULL ) hl_null_access();
	r55 = r21->_02;
	r21 = r15->self;
	if( r21 == NULL ) hl_null_access();
	r56 = r21->_12;
	r21 = r15->self;
	if( r21 == NULL ) hl_null_access();
	r57 = r21->_22;
	r58 = r47 + r53;
	r58 = r58 + r57;
	r6 = 0.;
	r60 = 0;
	r61 = (float)r60;
	if( !(r61 < r58) ) goto label$f408df5_2_425;
	r52 = 0.5;
	r62 = (double)r58;
	r63 = 1.;
	r62 = r62 + r63;
	r62 = hl_math_sqrt(r62);
	r52 = r52 / r62;
	r6 = r52;
	if( r10 == NULL ) hl_null_access();
	r52 = 0.25;
	r52 = r52 / r6;
	r59 = (float)r52;
	r10->w = r59;
	r59 = r56 - r54;
	r52 = (double)r59;
	r52 = r52 * r6;
	r59 = (float)r52;
	r10->x = r59;
	r59 = r49 - r55;
	r52 = (double)r59;
	r52 = r52 * r6;
	r59 = (float)r52;
	r10->y = r59;
	r59 = r50 - r48;
	r52 = (double)r59;
	r52 = r52 * r6;
	r59 = (float)r52;
	r10->z = r59;
	goto label$f408df5_2_523;
	label$f408df5_2_425:
	if( !(r53 < r47) ) goto label$f408df5_2_459;
	if( !(r57 < r47) ) goto label$f408df5_2_459;
	r52 = 2.;
	r62 = 1.;
	r63 = (double)r47;
	r62 = r62 + r63;
	r63 = (double)r53;
	r62 = r62 - r63;
	r63 = (double)r57;
	r62 = r62 - r63;
	r62 = hl_math_sqrt(r62);
	r52 = r52 * r62;
	r6 = r52;
	if( r10 == NULL ) hl_null_access();
	r59 = r56 - r54;
	r52 = (double)r59;
	r52 = r52 / r6;
	r59 = (float)r52;
	r10->w = r59;
	r52 = 0.25;
	r52 = r52 * r6;
	r59 = (float)r52;
	r10->x = r59;
	r59 = r48 + r50;
	r52 = (double)r59;
	r52 = r52 / r6;
	r59 = (float)r52;
	r10->y = r59;
	r59 = r49 + r55;
	r52 = (double)r59;
	r52 = r52 / r6;
	r59 = (float)r52;
	r10->z = r59;
	goto label$f408df5_2_523;
	label$f408df5_2_459:
	if( !(r57 < r53) ) goto label$f408df5_2_492;
	r52 = 2.;
	r62 = 1.;
	r63 = (double)r53;
	r62 = r62 + r63;
	r63 = (double)r47;
	r62 = r62 - r63;
	r63 = (double)r57;
	r62 = r62 - r63;
	r62 = hl_math_sqrt(r62);
	r52 = r52 * r62;
	r6 = r52;
	if( r10 == NULL ) hl_null_access();
	r59 = r49 - r55;
	r52 = (double)r59;
	r52 = r52 / r6;
	r59 = (float)r52;
	r10->w = r59;
	r59 = r48 + r50;
	r52 = (double)r59;
	r52 = r52 / r6;
	r59 = (float)r52;
	r10->x = r59;
	r52 = 0.25;
	r52 = r52 * r6;
	r59 = (float)r52;
	r10->y = r59;
	r59 = r54 + r56;
	r52 = (double)r59;
	r52 = r52 / r6;
	r59 = (float)r52;
	r10->z = r59;
	goto label$f408df5_2_523;
	label$f408df5_2_492:
	r52 = 2.;
	r62 = 1.;
	r63 = (double)r57;
	r62 = r62 + r63;
	r63 = (double)r47;
	r62 = r62 - r63;
	r63 = (double)r53;
	r62 = r62 - r63;
	r62 = hl_math_sqrt(r62);
	r52 = r52 * r62;
	r6 = r52;
	if( r10 == NULL ) hl_null_access();
	r59 = r50 - r48;
	r52 = (double)r59;
	r52 = r52 / r6;
	r59 = (float)r52;
	r10->w = r59;
	r59 = r49 + r55;
	r52 = (double)r59;
	r52 = r52 / r6;
	r59 = (float)r52;
	r10->x = r59;
	r59 = r54 + r56;
	r52 = (double)r59;
	r52 = r52 / r6;
	r59 = (float)r52;
	r10->y = r59;
	r52 = 0.25;
	r52 = r52 * r6;
	r59 = (float)r52;
	r10->z = r59;
	label$f408df5_2_523:
	if( r1 == NULL ) hl_null_access();
	r8 = r1->transform;
	if( r8 == NULL ) hl_null_access();
	r9 = r0->ownerLoc;
	r8->loc = r9;
	r8 = r1->transform;
	if( r8 == NULL ) hl_null_access();
	r10 = r0->ownerRot;
	r8->rot = r10;
	r8 = r1->transform;
	if( r8 == NULL ) hl_null_access();
	r9 = (iron__math__Vec4)hl_alloc_obj(&t$iron_math_Vec4);
	r64 = r0->r;
	if( r64 == NULL ) hl_null_access();
	r13 = r64->particle_size;
	r65 = &r13;
	r64 = r0->r;
	if( r64 == NULL ) hl_null_access();
	r18 = r64->particle_size;
	r66 = &r18;
	r64 = r0->r;
	if( r64 == NULL ) hl_null_access();
	r19 = r64->particle_size;
	r67 = &r19;
	r60 = 1;
	r22 = (float)r60;
	r68 = &r22;
	iron_math_Vec4_new(r9,r65,r66,r67,r68);
	r8->scale = r9;
	r8 = r1->transform;
	if( r8 == NULL ) hl_null_access();
	iron_object_Transform_buildMatrix(r8);
	r8 = r2->transform;
	if( r8 == NULL ) hl_null_access();
	iron_object_Transform_buildMatrix(r8);
	r8 = r1->transform;
	if( r8 == NULL ) hl_null_access();
	r9 = r8->dim;
	r8 = r2->transform;
	if( r8 == NULL ) hl_null_access();
	r11 = r8->dim;
	if( r9 == NULL ) hl_null_access();
	if( r11 == NULL ) hl_null_access();
	r23 = r11->x;
	r9->x = r23;
	r23 = r11->y;
	r9->y = r23;
	r23 = r11->z;
	r9->z = r23;
	r23 = r11->w;
	r9->w = r23;
	r8 = r1->transform;
	if( r8 == NULL ) hl_null_access();
	r9 = r8->dim;
	if( r9 == NULL ) hl_null_access();
	r23 = r9->x;
	r5 = (double)r23;
	r0->dimx = r5;
	r8 = r1->transform;
	if( r8 == NULL ) hl_null_access();
	r9 = r8->dim;
	if( r9 == NULL ) hl_null_access();
	r23 = r9->y;
	r5 = (double)r23;
	r0->dimy = r5;
	r69 = r1->tilesheet;
	if( !r69 ) goto label$f408df5_2_608;
	r69 = r1->tilesheet;
	if( r69 == NULL ) hl_null_access();
	r70 = r69->raw;
	if( r70 == NULL ) hl_null_access();
	r60 = r70->tilesx;
	r0->tilesx = r60;
	r69 = r1->tilesheet;
	if( r69 == NULL ) hl_null_access();
	r70 = r69->raw;
	if( r70 == NULL ) hl_null_access();
	r60 = r70->tilesy;
	r0->tilesy = r60;
	r69 = r1->tilesheet;
	if( r69 == NULL ) hl_null_access();
	r70 = r69->raw;
	if( r70 == NULL ) hl_null_access();
	r60 = r70->framerate;
	r0->tilesFramerate = r60;
	label$f408df5_2_608:
	r5 = r0->time;
	r71 = (iron__system__$Time)g$_iron_system_Time;
	r6 = r71->realDelta;
	r52 = r0->speed;
	r6 = r6 * r52;
	r5 = r5 + r6;
	r0->time = r5;
	r5 = r0->time;
	r6 = r0->animtime;
	r5 = r5 / r6;
	r60 = (int)r5;
	r0->lap = r60;
	r6 = r0->time;
	r60 = r0->lap;
	r52 = (double)r60;
	r62 = r0->animtime;
	r52 = r52 * r62;
	r6 = r6 - r52;
	r0->lapTime = r6;
	r6 = r0->lapTime;
	r52 = r0->spawnRate;
	r6 = r6 / r52;
	r60 = (int)r6;
	r0->count = r60;
	iron_object_ParticleSystem_updateGpu(r0,r1,r2);
	return;
}

iron__math__Mat4 iron_object_ParticleSystem_getData(iron__object__ParticleSystem r0) {
	hl__types__ArrayObj r10;
	kha__math__FastMatrix4 r5;
	bool r1, r8;
	iron__data__TParticleData r3;
	float r7;
	iron__math__Mat4 r6;
	double r9, r11;
	int r2, r4;
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r2 = r3->type;
	r4 = 1;
	if( r2 == r4 ) goto label$f408df5_3_7;
	r1 = false;
	goto label$f408df5_3_8;
	label$f408df5_3_7:
	r1 = true;
	label$f408df5_3_8:
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r8 = r3->loop;
	if( !r8 ) goto label$f408df5_3_19;
	r9 = r0->animtime;
	r7 = (float)r9;
	goto label$f408df5_3_22;
	label$f408df5_3_19:
	r9 = r0->animtime;
	r9 = -r9;
	r7 = (float)r9;
	label$f408df5_3_22:
	r5->_00 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	if( !r1 ) goto label$f408df5_3_36;
	r9 = 1.;
	r10 = r0->particles;
	if( r10 == NULL ) hl_null_access();
	r2 = r10->length;
	r11 = (double)r2;
	r9 = r9 / r11;
	r7 = (float)r9;
	goto label$f408df5_3_38;
	label$f408df5_3_36:
	r9 = r0->spawnRate;
	r7 = (float)r9;
	label$f408df5_3_38:
	r5->_01 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	if( !r1 ) goto label$f408df5_3_47;
	r2 = 1;
	r7 = (float)r2;
	goto label$f408df5_3_49;
	label$f408df5_3_47:
	r9 = r0->lifetime;
	r7 = (float)r9;
	label$f408df5_3_49:
	r5->_02 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	r10 = r0->particles;
	if( r10 == NULL ) hl_null_access();
	r2 = r10->length;
	r7 = (float)r2;
	r5->_03 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	if( !r1 ) goto label$f408df5_3_67;
	r2 = 0;
	r7 = (float)r2;
	goto label$f408df5_3_69;
	label$f408df5_3_67:
	r9 = r0->alignx;
	r7 = (float)r9;
	label$f408df5_3_69:
	r5->_10 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	if( !r1 ) goto label$f408df5_3_78;
	r2 = 0;
	r7 = (float)r2;
	goto label$f408df5_3_80;
	label$f408df5_3_78:
	r9 = r0->aligny;
	r7 = (float)r9;
	label$f408df5_3_80:
	r5->_11 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	if( !r1 ) goto label$f408df5_3_89;
	r2 = 0;
	r7 = (float)r2;
	goto label$f408df5_3_91;
	label$f408df5_3_89:
	r9 = r0->alignz;
	r7 = (float)r9;
	label$f408df5_3_91:
	r5->_12 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	if( !r1 ) goto label$f408df5_3_100;
	r2 = 0;
	r7 = (float)r2;
	goto label$f408df5_3_103;
	label$f408df5_3_100:
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r7 = r3->factor_random;
	label$f408df5_3_103:
	r5->_13 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	if( !r1 ) goto label$f408df5_3_112;
	r2 = 0;
	r7 = (float)r2;
	goto label$f408df5_3_119;
	label$f408df5_3_112:
	r9 = r0->gx;
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r7 = r3->mass;
	r11 = (double)r7;
	r9 = r9 * r11;
	r7 = (float)r9;
	label$f408df5_3_119:
	r5->_20 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	if( !r1 ) goto label$f408df5_3_128;
	r2 = 0;
	r7 = (float)r2;
	goto label$f408df5_3_135;
	label$f408df5_3_128:
	r9 = r0->gy;
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r7 = r3->mass;
	r11 = (double)r7;
	r9 = r9 * r11;
	r7 = (float)r9;
	label$f408df5_3_135:
	r5->_21 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	if( !r1 ) goto label$f408df5_3_144;
	r2 = 0;
	r7 = (float)r2;
	goto label$f408df5_3_151;
	label$f408df5_3_144:
	r9 = r0->gz;
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r7 = r3->mass;
	r11 = (double)r7;
	r9 = r9 * r11;
	r7 = (float)r9;
	label$f408df5_3_151:
	r5->_22 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	if( !r1 ) goto label$f408df5_3_160;
	r2 = 0;
	r7 = (float)r2;
	goto label$f408df5_3_163;
	label$f408df5_3_160:
	r3 = r0->r;
	if( r3 == NULL ) hl_null_access();
	r7 = r3->lifetime_random;
	label$f408df5_3_163:
	r5->_23 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	r2 = r0->tilesx;
	r7 = (float)r2;
	r5->_30 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	r2 = r0->tilesy;
	r7 = (float)r2;
	r5->_31 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	r9 = 1.;
	r2 = r0->tilesFramerate;
	r11 = (double)r2;
	r9 = r9 / r11;
	r7 = (float)r9;
	r5->_32 = r7;
	r6 = r0->m;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->self;
	if( r5 == NULL ) hl_null_access();
	if( !r1 ) goto label$f408df5_3_196;
	r2 = 1;
	r7 = (float)r2;
	goto label$f408df5_3_198;
	label$f408df5_3_196:
	r9 = r0->lapTime;
	r7 = (float)r9;
	label$f408df5_3_198:
	r5->_33 = r7;
	r6 = r0->m;
	return r6;
}

void iron_object_ParticleSystem_updateGpu(iron__object__ParticleSystem r0,iron__object__MeshObject r1,iron__object__MeshObject r2) {
	iron__data__Geometry r5;
	bool r4;
	iron__data__MeshData r6;
	if( r1 == NULL ) hl_null_access();
	r6 = r1->data;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->geom;
	if( r5 == NULL ) hl_null_access();
	r4 = r5->instanced;
	if( r4 ) goto label$f408df5_4_8;
	iron_object_ParticleSystem_setupGeomGpu(r0,r1,r2);
	label$f408df5_4_8:
	return;
}

void iron_object_ParticleSystem_setupGeomGpu(iron__object__ParticleSystem r0,iron__object__MeshObject r1,iron__object__MeshObject r2) {
	iron__data__Geometry r27;
	hl__types__ArrayObj r5, r30, r41;
	int64 r42;
	iron__object__Particle r31;
	iron__math__Vec4 r19, r22;
	iron__data__TParticleData r13;
	iron__object__Transform r20;
	iron__data__TVertexArray r26;
	kha__arrays__ByteArrayPrivate r3, r34, r38;
	iron__data__MeshData r10;
	float r9, r11, r12, r15, r16, r17, r18, r21, r23, r25, r46, r47, r48, r49, r50, r51, r52, r55, r56;
	double r8, r14, r24, r36, r53, r54;
	vdynamic *r32, *r35;
	vbyte *r37;
	varray *r33;
	int r4, r6, r28, r29, r39, r40, r43, r44, r45;
	r5 = r0->particles;
	if( r5 == NULL ) hl_null_access();
	r4 = r5->length;
	r6 = 3;
	r4 = r4 * r6;
	r3 = kha_arrays__Float32Array_Float32Array_Impl___new(r4);
	r4 = 0;
	r8 = 3.051850947599719227e-05;
	if( r2 == NULL ) hl_null_access();
	r10 = r2->data;
	if( r10 == NULL ) hl_null_access();
	r9 = r10->scalePos;
	if( r1 == NULL ) hl_null_access();
	r10 = r1->data;
	if( r10 == NULL ) hl_null_access();
	r11 = r10->scalePos;
	r13 = r0->r;
	if( r13 == NULL ) hl_null_access();
	r12 = r13->particle_size;
	r14 = 0.;
	r15 = (float)r14;
	r14 = 0.;
	r16 = (float)r14;
	r14 = 0.;
	r17 = (float)r14;
	r14 = 1.;
	r18 = (float)r14;
	r20 = r2->transform;
	if( r20 == NULL ) hl_null_access();
	r19 = r20->scale;
	if( r19 == NULL ) hl_null_access();
	r21 = r19->x;
	r15 = r21;
	r21 = r19->y;
	r16 = r21;
	r21 = r19->z;
	r17 = r21;
	r21 = r19->w;
	r14 = (double)r9;
	r21 = r12 * r11;
	r24 = (double)r21;
	r14 = r14 / r24;
	r21 = (float)r14;
	r23 = r15 * r21;
	r15 = r23;
	r23 = r16 * r21;
	r16 = r23;
	r23 = r17 * r21;
	r17 = r23;
	r13 = r0->r;
	if( r13 == NULL ) hl_null_access();
	r6 = r13->emit_from;
	switch(r6) {
		default:
			goto label$f408df5_5_523;
		case 0:
			r10 = r2->data;
			if( r10 == NULL ) hl_null_access();
			r27 = r10->geom;
			if( r27 == NULL ) hl_null_access();
			r26 = r27->positions;
			r6 = 0;
			r5 = r0->particles;
			label$f408df5_5_61:
			if( r5 == NULL ) hl_null_access();
			r29 = r5->length;
			if( r6 >= r29 ) goto label$f408df5_5_162;
			r29 = r5->length;
			if( ((unsigned)r6) < ((unsigned)r29) ) goto label$f408df5_5_69;
			r31 = NULL;
			goto label$f408df5_5_72;
			label$f408df5_5_69:
			r33 = r5->array;
			r32 = ((vdynamic**)(r33 + 1))[r6];
			r31 = (iron__object__Particle)r32;
			label$f408df5_5_72:
			++r6;
			r14 = iron_object_ParticleSystem_fhash(r0,r4);
			if( r26 == NULL ) hl_null_access();
			r34 = r26->values;
			if( r34 == NULL ) hl_null_access();
			r28 = r34->byteArrayLength;
			r29 = 1;
			r28 = r28 >> r29;
			r24 = (double)r28;
			r35 = r26->size;
			r28 = r35 ? r35->v.i : 0;
			r36 = (double)r28;
			r24 = r24 / r36;
			r14 = r14 * r24;
			r28 = (int)r14;
			r34 = r26->values;
			if( r34 == NULL ) hl_null_access();
			r37 = r34->self;
			r29 = r34->byteArrayOffset;
			r35 = r26->size;
			r40 = r35 ? r35->v.i : 0;
			r39 = r28 * r40;
			r40 = 2;
			r39 = r39 * r40;
			r29 = r29 + r39;
			r29 = hl_kinc_bytearray_getint16(r37,r29);
			r24 = (double)r29;
			r24 = r24 * r8;
			r36 = (double)r15;
			r24 = r24 * r36;
			r23 = (float)r24;
			if( r3 == NULL ) hl_null_access();
			r37 = r3->self;
			r29 = r3->byteArrayOffset;
			r40 = 4;
			r39 = r4 * r40;
			r29 = r29 + r39;
			hl_kinc_bytearray_setfloat32(r37,r29,r23);
			++r4;
			r34 = r26->values;
			if( r34 == NULL ) hl_null_access();
			r37 = r34->self;
			r29 = r34->byteArrayOffset;
			r35 = r26->size;
			r40 = r35 ? r35->v.i : 0;
			r39 = r28 * r40;
			r40 = 1;
			r39 = r39 + r40;
			r40 = 2;
			r39 = r39 * r40;
			r29 = r29 + r39;
			r29 = hl_kinc_bytearray_getint16(r37,r29);
			r24 = (double)r29;
			r24 = r24 * r8;
			r36 = (double)r16;
			r24 = r24 * r36;
			r23 = (float)r24;
			r37 = r3->self;
			r29 = r3->byteArrayOffset;
			r40 = 4;
			r39 = r4 * r40;
			r29 = r29 + r39;
			hl_kinc_bytearray_setfloat32(r37,r29,r23);
			++r4;
			r34 = r26->values;
			if( r34 == NULL ) hl_null_access();
			r37 = r34->self;
			r29 = r34->byteArrayOffset;
			r35 = r26->size;
			r40 = r35 ? r35->v.i : 0;
			r39 = r28 * r40;
			r40 = 2;
			r39 = r39 + r40;
			r40 = 2;
			r39 = r39 * r40;
			r29 = r29 + r39;
			r29 = hl_kinc_bytearray_getint16(r37,r29);
			r24 = (double)r29;
			r24 = r24 * r8;
			r36 = (double)r17;
			r24 = r24 * r36;
			r23 = (float)r24;
			r37 = r3->self;
			r29 = r3->byteArrayOffset;
			r40 = 4;
			r39 = r4 * r40;
			r29 = r29 + r39;
			hl_kinc_bytearray_setfloat32(r37,r29,r23);
			++r4;
			goto label$f408df5_5_61;
			label$f408df5_5_162:
			goto label$f408df5_5_523;
		case 1:
			r10 = r2->data;
			if( r10 == NULL ) hl_null_access();
			r27 = r10->geom;
			if( r27 == NULL ) hl_null_access();
			r26 = r27->positions;
			if( r26 == NULL ) hl_null_access();
			r34 = r26->values;
			r6 = 0;
			r5 = r0->particles;
			label$f408df5_5_172:
			if( r5 == NULL ) hl_null_access();
			r29 = r5->length;
			if( r6 >= r29 ) goto label$f408df5_5_431;
			r29 = r5->length;
			if( ((unsigned)r6) < ((unsigned)r29) ) goto label$f408df5_5_180;
			r31 = NULL;
			goto label$f408df5_5_183;
			label$f408df5_5_180:
			r33 = r5->array;
			r32 = ((vdynamic**)(r33 + 1))[r6];
			r31 = (iron__object__Particle)r32;
			label$f408df5_5_183:
			++r6;
			if( r2 == NULL ) hl_null_access();
			r10 = r2->data;
			if( r10 == NULL ) hl_null_access();
			r27 = r10->geom;
			if( r27 == NULL ) hl_null_access();
			r30 = r27->indices;
			if( r30 == NULL ) hl_null_access();
			r10 = r2->data;
			if( r10 == NULL ) hl_null_access();
			r27 = r10->geom;
			if( r27 == NULL ) hl_null_access();
			r41 = r27->indices;
			if( r41 == NULL ) hl_null_access();
			r28 = r41->length;
			r28 = Std_random(r28);
			r29 = r30->length;
			if( ((unsigned)r28) < ((unsigned)r29) ) goto label$f408df5_5_203;
			r38 = NULL;
			goto label$f408df5_5_206;
			label$f408df5_5_203:
			r33 = r30->array;
			r32 = ((vdynamic**)(r33 + 1))[r28];
			r38 = (kha__arrays__ByteArrayPrivate)r32;
			label$f408df5_5_206:
			if( r38 == NULL ) hl_null_access();
			r28 = r38->byteArrayLength;
			r29 = 2;
			r28 = r28 >> r29;
			r14 = (double)r28;
			r24 = 3.;
			r14 = r14 / r24;
			r28 = (int)r14;
			r28 = Std_random(r28);
			r37 = r38->self;
			r29 = r38->byteArrayOffset;
			r40 = 3;
			r39 = r28 * r40;
			r40 = 4;
			r39 = r39 * r40;
			r29 = r29 + r39;
			r42 = hl_kinc_bytearray_getuint32(r37,r29);
			r29 = (int)r42;
			r37 = r38->self;
			r39 = r38->byteArrayOffset;
			r43 = 3;
			r40 = r28 * r43;
			r43 = 1;
			r40 = r40 + r43;
			r43 = 4;
			r40 = r40 * r43;
			r39 = r39 + r40;
			r42 = hl_kinc_bytearray_getuint32(r37,r39);
			r39 = (int)r42;
			r37 = r38->self;
			r40 = r38->byteArrayOffset;
			r44 = 3;
			r43 = r28 * r44;
			r44 = 2;
			r43 = r43 + r44;
			r44 = 4;
			r43 = r43 * r44;
			r40 = r40 + r43;
			r42 = hl_kinc_bytearray_getuint32(r37,r40);
			r40 = (int)r42;
			if( r34 == NULL ) hl_null_access();
			r37 = r34->self;
			r43 = r34->byteArrayOffset;
			r45 = 4;
			r44 = r29 * r45;
			r45 = 2;
			r44 = r44 * r45;
			r43 = r43 + r44;
			r43 = hl_kinc_bytearray_getint16(r37,r43);
			r23 = (float)r43;
			r37 = r34->self;
			r43 = r34->byteArrayOffset;
			r45 = 4;
			r44 = r29 * r45;
			r45 = 1;
			r44 = r44 + r45;
			r45 = 2;
			r44 = r44 * r45;
			r43 = r43 + r44;
			r43 = hl_kinc_bytearray_getint16(r37,r43);
			r25 = (float)r43;
			r37 = r34->self;
			r43 = r34->byteArrayOffset;
			r45 = 4;
			r44 = r29 * r45;
			r45 = 2;
			r44 = r44 + r45;
			r45 = 2;
			r44 = r44 * r45;
			r43 = r43 + r44;
			r43 = hl_kinc_bytearray_getint16(r37,r43);
			r46 = (float)r43;
			r37 = r34->self;
			r43 = r34->byteArrayOffset;
			r45 = 4;
			r44 = r39 * r45;
			r45 = 2;
			r44 = r44 * r45;
			r43 = r43 + r44;
			r43 = hl_kinc_bytearray_getint16(r37,r43);
			r47 = (float)r43;
			r37 = r34->self;
			r43 = r34->byteArrayOffset;
			r45 = 4;
			r44 = r39 * r45;
			r45 = 1;
			r44 = r44 + r45;
			r45 = 2;
			r44 = r44 * r45;
			r43 = r43 + r44;
			r43 = hl_kinc_bytearray_getint16(r37,r43);
			r48 = (float)r43;
			r37 = r34->self;
			r43 = r34->byteArrayOffset;
			r45 = 4;
			r44 = r39 * r45;
			r45 = 2;
			r44 = r44 + r45;
			r45 = 2;
			r44 = r44 * r45;
			r43 = r43 + r44;
			r43 = hl_kinc_bytearray_getint16(r37,r43);
			r49 = (float)r43;
			r37 = r34->self;
			r43 = r34->byteArrayOffset;
			r45 = 4;
			r44 = r40 * r45;
			r45 = 2;
			r44 = r44 * r45;
			r43 = r43 + r44;
			r43 = hl_kinc_bytearray_getint16(r37,r43);
			r50 = (float)r43;
			r37 = r34->self;
			r43 = r34->byteArrayOffset;
			r45 = 4;
			r44 = r40 * r45;
			r45 = 1;
			r44 = r44 + r45;
			r45 = 2;
			r44 = r44 * r45;
			r43 = r43 + r44;
			r43 = hl_kinc_bytearray_getint16(r37,r43);
			r51 = (float)r43;
			r37 = r34->self;
			r43 = r34->byteArrayOffset;
			r45 = 4;
			r44 = r40 * r45;
			r45 = 2;
			r44 = r44 + r45;
			r45 = 2;
			r44 = r44 * r45;
			r43 = r43 + r44;
			r43 = hl_kinc_bytearray_getint16(r37,r43);
			r52 = (float)r43;
			r24 = Math_random();
			r36 = Math_random();
			r53 = r24 + r36;
			r54 = 1.;
			if( !(r54 < r53) ) goto label$f408df5_5_351;
			r53 = 1.;
			r53 = r53 - r24;
			r24 = r53;
			r53 = 1.;
			r53 = r53 - r36;
			r36 = r53;
			label$f408df5_5_351:
			r55 = r47 - r23;
			r47 = r55;
			r55 = r48 - r25;
			r48 = r55;
			r55 = r49 - r46;
			r49 = r55;
			r55 = r50 - r23;
			r50 = r55;
			r55 = r51 - r25;
			r51 = r55;
			r55 = r52 - r46;
			r52 = r55;
			r56 = (float)r24;
			r55 = r47 * r56;
			r47 = r55;
			r56 = (float)r24;
			r55 = r48 * r56;
			r48 = r55;
			r56 = (float)r24;
			r55 = r49 * r56;
			r49 = r55;
			r56 = (float)r36;
			r55 = r50 * r56;
			r50 = r55;
			r56 = (float)r36;
			r55 = r51 * r56;
			r51 = r55;
			r56 = (float)r36;
			r55 = r52 * r56;
			r52 = r55;
			r55 = r47 + r50;
			r47 = r55;
			r55 = r48 + r51;
			r48 = r55;
			r55 = r49 + r52;
			r49 = r55;
			r55 = r23 + r47;
			r23 = r55;
			r55 = r25 + r48;
			r25 = r55;
			r55 = r46 + r49;
			r46 = r55;
			r53 = (double)r23;
			r53 = r53 * r8;
			r54 = (double)r15;
			r53 = r53 * r54;
			r55 = (float)r53;
			if( r3 == NULL ) hl_null_access();
			r37 = r3->self;
			r43 = r3->byteArrayOffset;
			r45 = 4;
			r44 = r4 * r45;
			r43 = r43 + r44;
			hl_kinc_bytearray_setfloat32(r37,r43,r55);
			++r4;
			r53 = (double)r25;
			r53 = r53 * r8;
			r54 = (double)r16;
			r53 = r53 * r54;
			r55 = (float)r53;
			r37 = r3->self;
			r43 = r3->byteArrayOffset;
			r45 = 4;
			r44 = r4 * r45;
			r43 = r43 + r44;
			hl_kinc_bytearray_setfloat32(r37,r43,r55);
			++r4;
			r53 = (double)r46;
			r53 = r53 * r8;
			r54 = (double)r17;
			r53 = r53 * r54;
			r55 = (float)r53;
			r37 = r3->self;
			r43 = r3->byteArrayOffset;
			r45 = 4;
			r44 = r4 * r45;
			r43 = r43 + r44;
			hl_kinc_bytearray_setfloat32(r37,r43,r55);
			++r4;
			goto label$f408df5_5_172;
			label$f408df5_5_431:
			goto label$f408df5_5_523;
		case 2:
			r14 = 0.;
			r23 = (float)r14;
			r14 = 0.;
			r25 = (float)r14;
			r14 = 0.;
			r46 = (float)r14;
			r14 = 1.;
			r47 = (float)r14;
			r20 = r1->transform;
			if( r20 == NULL ) hl_null_access();
			r22 = r20->dim;
			if( r22 == NULL ) hl_null_access();
			r48 = r22->x;
			r23 = r48;
			r48 = r22->y;
			r25 = r48;
			r48 = r22->z;
			r46 = r48;
			r48 = r22->w;
			r14 = 0.5;
			r48 = r12 * r11;
			r24 = (double)r48;
			r14 = r14 / r24;
			r48 = (float)r14;
			r49 = r23 * r48;
			r23 = r49;
			r49 = r25 * r48;
			r25 = r49;
			r49 = r46 * r48;
			r46 = r49;
			r6 = 0;
			r5 = r0->particles;
			label$f408df5_5_464:
			if( r5 == NULL ) hl_null_access();
			r29 = r5->length;
			if( r6 >= r29 ) goto label$f408df5_5_523;
			r29 = r5->length;
			if( ((unsigned)r6) < ((unsigned)r29) ) goto label$f408df5_5_472;
			r31 = NULL;
			goto label$f408df5_5_475;
			label$f408df5_5_472:
			r33 = r5->array;
			r32 = ((vdynamic**)(r33 + 1))[r6];
			r31 = (iron__object__Particle)r32;
			label$f408df5_5_475:
			++r6;
			r14 = Math_random();
			r24 = 2.;
			r14 = r14 * r24;
			r24 = 1.;
			r14 = r14 - r24;
			r24 = (double)r23;
			r14 = r14 * r24;
			r49 = (float)r14;
			if( r3 == NULL ) hl_null_access();
			r37 = r3->self;
			r28 = r3->byteArrayOffset;
			r39 = 4;
			r29 = r4 * r39;
			r28 = r28 + r29;
			hl_kinc_bytearray_setfloat32(r37,r28,r49);
			++r4;
			r14 = Math_random();
			r24 = 2.;
			r14 = r14 * r24;
			r24 = 1.;
			r14 = r14 - r24;
			r24 = (double)r25;
			r14 = r14 * r24;
			r49 = (float)r14;
			r37 = r3->self;
			r28 = r3->byteArrayOffset;
			r39 = 4;
			r29 = r4 * r39;
			r28 = r28 + r29;
			hl_kinc_bytearray_setfloat32(r37,r28,r49);
			++r4;
			r14 = Math_random();
			r24 = 2.;
			r14 = r14 * r24;
			r24 = 1.;
			r14 = r14 - r24;
			r24 = (double)r46;
			r14 = r14 * r24;
			r49 = (float)r14;
			r37 = r3->self;
			r28 = r3->byteArrayOffset;
			r39 = 4;
			r29 = r4 * r39;
			r28 = r28 + r29;
			hl_kinc_bytearray_setfloat32(r37,r28,r49);
			++r4;
			goto label$f408df5_5_464;
	}
	label$f408df5_5_523:
	if( r1 == NULL ) hl_null_access();
	r10 = r1->data;
	if( r10 == NULL ) hl_null_access();
	r27 = r10->geom;
	if( r27 == NULL ) hl_null_access();
	r6 = 1;
	r28 = 0;
	iron_data_Geometry_setupInstanced(r27,r3,r6,r28);
	return;
}

double iron_object_ParticleSystem_fhash(iron__object__ParticleSystem r0,int r1) {
	double r2, r3, r4;
	r2 = (double)r1;
	r3 = 1.;
	r2 = r2 + r3;
	r4 = 9301.;
	r4 = fmod(r4,r2);
	r3 = r2 * r4;
	r4 = 9301.;
	r3 = r3 * r4;
	r4 = 49297.;
	r3 = r3 + r4;
	r4 = 233280.;
	r3 = fmod(r3,r4);
	r4 = 233280.;
	r3 = r3 / r4;
	return r3;
}

void iron_object_ParticleSystem_remove(iron__object__ParticleSystem r0) {
	return;
}

void iron_object_ParticleSystem_new(iron__object__ParticleSystem r0,String r1,iron__data__TParticleReference r2) {
	String r33;
	hl__types__ArrayObj r29;
	iron__math__Quat r9;
	hl_type *r31;
	bool r32;
	iron__math__Vec4 r3;
	float r12, r13, r14, r15, r16, r17, r18, r19, r20, r21, r22, r23, r24, r25, r26, r27;
	iron__math__Mat4 r10;
	vclosure *r34;
	double r11;
	varray *r30;
	int r28;
	float *r4, *r5, *r6, *r7;
	r3 = (iron__math__Vec4)hl_alloc_obj(&t$iron_math_Vec4);
	r4 = NULL;
	r5 = NULL;
	r6 = NULL;
	r7 = NULL;
	iron_math_Vec4_new(r3,r4,r5,r6,r7);
	r0->ownerScl = r3;
	r9 = (iron__math__Quat)hl_alloc_obj(&t$iron_math_Quat);
	r4 = NULL;
	r5 = NULL;
	r6 = NULL;
	r7 = NULL;
	iron_math_Quat_new(r9,r4,r5,r6,r7);
	r0->ownerRot = r9;
	r3 = (iron__math__Vec4)hl_alloc_obj(&t$iron_math_Vec4);
	r4 = NULL;
	r5 = NULL;
	r6 = NULL;
	r7 = NULL;
	iron_math_Vec4_new(r3,r4,r5,r6,r7);
	r0->ownerLoc = r3;
	r10 = (iron__math__Mat4)hl_alloc_obj(&t$iron_math_Mat4);
	r11 = 1.;
	r12 = (float)r11;
	r11 = 0.;
	r13 = (float)r11;
	r11 = 0.;
	r14 = (float)r11;
	r11 = 0.;
	r15 = (float)r11;
	r11 = 0.;
	r16 = (float)r11;
	r11 = 1.;
	r17 = (float)r11;
	r11 = 0.;
	r18 = (float)r11;
	r11 = 0.;
	r19 = (float)r11;
	r11 = 0.;
	r20 = (float)r11;
	r11 = 0.;
	r21 = (float)r11;
	r11 = 1.;
	r22 = (float)r11;
	r11 = 0.;
	r23 = (float)r11;
	r11 = 0.;
	r24 = (float)r11;
	r11 = 0.;
	r25 = (float)r11;
	r11 = 0.;
	r26 = (float)r11;
	r11 = 1.;
	r27 = (float)r11;
	iron_math_Mat4_new(r10,r12,r13,r14,r15,r16,r17,r18,r19,r20,r21,r22,r23,r24,r25,r26,r27);
	r0->m = r10;
	r11 = 0.;
	r0->lapTime = r11;
	r28 = 0;
	r0->lap = r28;
	r28 = 0;
	r0->count = r28;
	r28 = 0;
	r0->seed = r28;
	r11 = 0.;
	r0->spawnRate = r11;
	r11 = 0.;
	r0->time = r11;
	r11 = 0.;
	r0->animtime = r11;
	r11 = 0.;
	r0->lifetime = r11;
	r28 = 24;
	r0->frameRate = r28;
	r11 = 1.;
	r0->speed = r11;
	if( r2 == NULL ) hl_null_access();
	r28 = r2->seed;
	r0->seed = r28;
	r31 = &t$iron_object_Particle;
	r28 = 0;
	r30 = hl_alloc_array(r31,r28);
	r29 = hl_types_ArrayObj_alloc(r30);
	r0->particles = r29;
	r32 = false;
	r0->ready = r32;
	r33 = r2->particle;
	r34 = hl_alloc_closure_ptr(&t$fun_9cbeb3a,iron_object_ParticleSystem_new__$1,r0);
	iron_data_Data_getParticle(r1,r33,r34);
	return;
}


// Generated by HLC 4.2.5 (HL v4)
#define HLC_BOOT
#include <hlc.h>
#include <iron/data/WorldData.h>
void iron_data_WorldData_loadEnvmap(iron__data__WorldData,vclosure*);
#include <iron/data/TProbeData.h>
extern hl_type t$iron_data_Probe;
extern hl_type t$ctx_a709584;
extern hl_type t$fun_b736949;
void iron_data_Probe_new(iron__data__Probe,iron__data__TProbeData,vclosure*);
extern hl_type t$fun_e4cb2db;
void iron_data_Data_getImage(String,vclosure*,bool*,String);
#include <iron/data/TSceneFormat.h>
#include <hl/types/ArrayObj.h>
#include <hl/types/ArrayDyn.h>
#include <haxe/Log.h>
iron__data__TWorldData iron_data_Data_getWorldRawByName(hl__types__ArrayObj,String);
extern haxe__$Log g$_haxe_Log;
extern String s$World_data_;
String String___add__(String,String);
extern String s$_not_found_;
extern hl_type t$vrt_329ffa8;
extern String s$Sources_iron_data_WorldData_hx;
extern hl_type t$String;
extern hl_type t$_i32;
extern String s$iron_data_WorldData;
extern String s$parse;
extern hl_type t$vrt_eaa6a3b;
extern hl_type t$iron_data_WorldData;
extern hl_type t$ctx_13c528e;
extern hl_type t$fun_d5be1f3;
void iron_data_Data_getSceneRaw(String,vclosure*);
extern iron__data__$WorldData g$_iron_data_WorldData;
kha__arrays__ByteArrayPrivate kha_arrays__Float32Array_Float32Array_Impl___new(int);
#include <hl/natives.h>

void iron_data_WorldData_new__$1(venum* r0,iron__data__Probe r1) {
	iron__data__WorldData r2;
	vclosure *r4;
	r2 = ((Enumt$ctx_a709584*)r0)->p1;
	if( r2 == NULL ) hl_null_access();
	r2->probe = r1;
	r2 = ((Enumt$ctx_a709584*)r0)->p1;
	if( r2 == NULL ) hl_null_access();
	r4 = ((Enumt$ctx_a709584*)r0)->p0;
	iron_data_WorldData_loadEnvmap(r2,r4);
	return;
}

void iron_data_WorldData_new(iron__data__WorldData r0,iron__data__TWorldData r1,vclosure* r2) {
	String r4;
	venum *r8;
	iron__data__Probe r6;
	iron__data__TProbeData r5;
	vclosure *r7;
	r0->raw = r1;
	if( r1 == NULL ) hl_null_access();
	r4 = r1->name;
	r0->name = r4;
	r5 = r1->probe;
	if( !r5 ) goto label$f835eeb_2_14;
	r6 = (iron__data__Probe)hl_alloc_obj(&t$iron_data_Probe);
	r5 = r1->probe;
	r8 = hl_alloc_enum(&t$ctx_a709584,0);
	((Enumt$ctx_a709584*)r8)->p0 = (vclosure*)r2;
	((Enumt$ctx_a709584*)r8)->p1 = (iron__data__WorldData)r0;
	r7 = hl_alloc_closure_ptr(&t$fun_b736949,iron_data_WorldData_new__$1,r8);
	iron_data_Probe_new(r6,r5,r7);
	goto label$f835eeb_2_15;
	label$f835eeb_2_14:
	iron_data_WorldData_loadEnvmap(r0,r2);
	label$f835eeb_2_15:
	return;
}

void iron_data_WorldData_loadEnvmap__$1(venum* r0,kha__Image r1) {
	iron__data__WorldData r2;
	vclosure *r4;
	r2 = ((Enumt$ctx_a709584*)r0)->p1;
	if( r2 == NULL ) hl_null_access();
	r2->envmap = r1;
	r4 = ((Enumt$ctx_a709584*)r0)->p0;
	if( r4 == NULL ) hl_null_access();
	r2 = ((Enumt$ctx_a709584*)r0)->p1;
	r4->hasValue ? ((void (*)(vdynamic*,iron__data__WorldData))r4->fun)((vdynamic*)r4->value,r2) : ((void (*)(iron__data__WorldData))r4->fun)(r2);
	return;
}

void iron_data_WorldData_loadEnvmap(iron__data__WorldData r0,vclosure* r1) {
	bool *r7;
	String r3, r8;
	venum *r6;
	iron__data__TWorldData r4;
	vclosure *r5;
	r4 = r0->raw;
	if( r4 == NULL ) hl_null_access();
	r3 = r4->envmap;
	if( !r3 ) goto label$f835eeb_4_15;
	r4 = r0->raw;
	if( r4 == NULL ) hl_null_access();
	r3 = r4->envmap;
	r6 = hl_alloc_enum(&t$ctx_a709584,0);
	((Enumt$ctx_a709584*)r6)->p0 = (vclosure*)r1;
	((Enumt$ctx_a709584*)r6)->p1 = (iron__data__WorldData)r0;
	r5 = hl_alloc_closure_ptr(&t$fun_e4cb2db,iron_data_WorldData_loadEnvmap__$1,r6);
	r7 = NULL;
	r8 = NULL;
	iron_data_Data_getImage(r3,r5,r7,r8);
	goto label$f835eeb_4_17;
	label$f835eeb_4_15:
	if( r1 == NULL ) hl_null_access();
	r1->hasValue ? ((void (*)(vdynamic*,iron__data__WorldData))r1->fun)((vdynamic*)r1->value,r0) : ((void (*)(iron__data__WorldData))r1->fun)(r0);
	label$f835eeb_4_17:
	return;
}

void iron_data_WorldData_parse__$1(venum* r0,iron__data__TSceneFormat r1) {
	String r4, r8;
	vvirtual *r9, *r11;
	hl__types__ArrayObj r3;
	haxe__$Log r7;
	iron__data__TWorldData r2;
	iron__data__WorldData r13;
	vclosure *r6, *r12;
	int r10;
	if( r1 == NULL ) hl_null_access();
	r3 = r1->world_datas;
	r4 = ((Enumt$ctx_13c528e*)r0)->p0;
	r2 = iron_data_Data_getWorldRawByName(r3,r4);
	if( r2 ) goto label$f835eeb_5_28;
	r7 = (haxe__$Log)g$_haxe_Log;
	r6 = r7->trace;
	if( r6 == NULL ) hl_null_access();
	r4 = (String)s$World_data_;
	r8 = ((Enumt$ctx_13c528e*)r0)->p0;
	r4 = String___add__(r4,r8);
	r8 = (String)s$_not_found_;
	r4 = String___add__(r4,r8);
	r9 = hl_alloc_virtual(&t$vrt_329ffa8);
	r8 = (String)s$Sources_iron_data_WorldData_hx;
	if( hl_vfields(r9)[1] ) *(String*)(hl_vfields(r9)[1]) = (String)r8; else hl_dyn_setp(r9->value,37969014/*fileName*/,&t$String,r8);
	r10 = 57;
	if( hl_vfields(r9)[2] ) *(int*)(hl_vfields(r9)[2]) = (int)r10; else hl_dyn_seti(r9->value,371360620/*lineNumber*/,&t$_i32,r10);
	r8 = (String)s$iron_data_WorldData;
	if( hl_vfields(r9)[0] ) *(String*)(hl_vfields(r9)[0]) = (String)r8; else hl_dyn_setp(r9->value,-63073762/*className*/,&t$String,r8);
	r8 = (String)s$parse;
	if( hl_vfields(r9)[3] ) *(String*)(hl_vfields(r9)[3]) = (String)r8; else hl_dyn_setp(r9->value,302979532/*methodName*/,&t$String,r8);
	r11 = hl_to_virtual(&t$vrt_eaa6a3b,(vdynamic*)r9);
	r6->hasValue ? ((void (*)(vdynamic*,vdynamic*,vvirtual*))r6->fun)((vdynamic*)r6->value,((vdynamic*)r4),r11) : ((void (*)(vdynamic*,vvirtual*))r6->fun)(((vdynamic*)r4),r11);
	r12 = ((Enumt$ctx_13c528e*)r0)->p1;
	if( r12 == NULL ) hl_null_access();
	r13 = NULL;
	r12->hasValue ? ((void (*)(vdynamic*,iron__data__WorldData))r12->fun)((vdynamic*)r12->value,r13) : ((void (*)(iron__data__WorldData))r12->fun)(r13);
	label$f835eeb_5_28:
	r13 = (iron__data__WorldData)hl_alloc_obj(&t$iron_data_WorldData);
	r12 = ((Enumt$ctx_13c528e*)r0)->p1;
	iron_data_WorldData_new(r13,r2,r12);
	return;
}

void iron_data_WorldData_parse(String r0,String r1,vclosure* r2) {
	venum *r5;
	vclosure *r4;
	r5 = hl_alloc_enum(&t$ctx_13c528e,0);
	((Enumt$ctx_13c528e*)r5)->p0 = (String)r1;
	((Enumt$ctx_13c528e*)r5)->p1 = (vclosure*)r2;
	r4 = hl_alloc_closure_ptr(&t$fun_d5be1f3,iron_data_WorldData_parse__$1,r5);
	iron_data_Data_getSceneRaw(r0,r4);
	return;
}

kha__arrays__ByteArrayPrivate iron_data_WorldData_getEmptyIrradiance() {
	iron__data__$WorldData r2;
	kha__arrays__ByteArrayPrivate r1;
	float r11;
	double r10;
	vbyte *r7;
	int r3, r4, r5, r6, r8, r9;
	r2 = (iron__data__$WorldData)g$_iron_data_WorldData;
	r1 = r2->emptyIrr;
	if( r1 ) goto label$f835eeb_7_30;
	r3 = 28;
	r1 = kha_arrays__Float32Array_Float32Array_Impl___new(r3);
	r2 = (iron__data__$WorldData)g$_iron_data_WorldData;
	r2->emptyIrr = r1;
	r3 = 0;
	r2 = (iron__data__$WorldData)g$_iron_data_WorldData;
	r1 = r2->emptyIrr;
	if( r1 == NULL ) hl_null_access();
	r4 = r1->byteArrayLength;
	r5 = 2;
	r4 = r4 >> r5;
	label$f835eeb_7_14:
	if( r3 >= r4 ) goto label$f835eeb_7_30;
	r5 = r3;
	++r3;
	r2 = (iron__data__$WorldData)g$_iron_data_WorldData;
	r1 = r2->emptyIrr;
	if( r1 == NULL ) hl_null_access();
	r7 = r1->self;
	r6 = r1->byteArrayOffset;
	r9 = 4;
	r8 = r5 * r9;
	r6 = r6 + r8;
	r10 = 0.;
	r11 = (float)r10;
	hl_kinc_bytearray_setfloat32(r7,r6,r11);
	goto label$f835eeb_7_14;
	label$f835eeb_7_30:
	r2 = (iron__data__$WorldData)g$_iron_data_WorldData;
	r1 = r2->emptyIrr;
	return r1;
}


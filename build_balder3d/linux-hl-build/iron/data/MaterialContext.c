// Generated by HLC 4.2.5 (HL v4)
#define HLC_BOOT
#include <hlc.h>
#include <iron/data/MaterialContext.h>
void hl_types_ArrayObj___expand(hl__types__ArrayObj,int);
void hl_types_ArrayBytes_Int___expand(hl__types__ArrayBytes_Int,int);
void kha_Image_setMipmaps(kha__Image,hl__types__ArrayObj);
extern hl_type t$kha_Image;
#include <hl/natives.h>
hl__types__ArrayObj hl_types_ArrayObj_alloc(varray*);
int hl_types_ArrayObj_push(hl__types__ArrayObj,vdynamic*);
hl__types__ArrayBytes_Int hl_types_ArrayBase_allocI32(vbyte*,int);
extern hl_type t$ctx_bc67316;
extern hl_type t$fun_29746a5;
void iron_data_Data_getImage(String,vclosure*,bool*,String);
void kha_Image_generateMipmaps(kha__Image,int);
#include <kha/graphics4/VertexBuffer.h>
#include <kha/graphics4/PipelineState.h>
#include <kha/math/FastMatrix3.h>
#include <kha/math/FastMatrix4.h>
#include <kha/graphics4/IndexBuffer.h>
#include <kha/arrays/ByteArrayPrivate.h>
#include <kha/graphics4/CubeMap.h>
#include <iron/data/ShaderContext.h>
void iron_data_ShaderContext_setTextureParameters(iron__data__ShaderContext,vvirtual*,int,iron__data__TBindTexture);
extern iron__data__$MaterialContext g$_iron_data_MaterialContext;
extern hl_type t$_dyn;
extern String s$;
int String___compare(String,vdynamic*);
extern String s$movie;
extern hl_type t$ctx_bff41cf;
extern hl_type t$fun_c4af003;
extern String s$RGBA32;

void iron_data_MaterialContext_new__$2(venum* r0,kha__Image r1) {
	kha__Image r4;
	hl__types__ArrayObj r2;
	iron__data__MaterialContext r16;
	bool r12;
	iron__data__TMaterialContext r14;
	hl__types__ArrayBytes_Int r8;
	iron__data__TBindTexture r11;
	vclosure *r15;
	vdynamic *r13;
	vbyte *r9;
	varray *r7;
	int r3, r5, r10;
	r2 = ((Enumt$ctx_bc67316*)r0)->p6;
	if( r2 == NULL ) hl_null_access();
	r3 = ((Enumt$ctx_bc67316*)r0)->p8;
	r5 = r2->length;
	if( ((unsigned)r3) < ((unsigned)r5) ) goto label$28664a1_1_6;
	hl_types_ArrayObj___expand(r2,r3);
	label$28664a1_1_6:
	r7 = r2->array;
	((kha__Image*)(r7 + 1))[r3] = r1;
	r8 = ((Enumt$ctx_bc67316*)r0)->p7;
	if( r8 == NULL ) hl_null_access();
	r3 = 0;
	r5 = r8->length;
	if( ((unsigned)r3) < ((unsigned)r5) ) goto label$28664a1_1_14;
	hl_types_ArrayBytes_Int___expand(r8,r3);
	label$28664a1_1_14:
	r9 = r8->bytes;
	r5 = 2;
	r5 = r3 << r5;
	r10 = *(int*)(r9 + r5);
	++r10;
	*(int*)(r9 + r5) = r10;
	r8 = ((Enumt$ctx_bc67316*)r0)->p7;
	if( r8 == NULL ) hl_null_access();
	r3 = 0;
	r5 = r8->length;
	if( ((unsigned)r3) < ((unsigned)r5) ) goto label$28664a1_1_27;
	r3 = 0;
	goto label$28664a1_1_31;
	label$28664a1_1_27:
	r9 = r8->bytes;
	r5 = 2;
	r5 = r3 << r5;
	r3 = *(int*)(r9 + r5);
	label$28664a1_1_31:
	r11 = ((Enumt$ctx_bc67316*)r0)->p3;
	if( r11 == NULL ) hl_null_access();
	r2 = r11->mipmaps;
	if( r2 == NULL ) hl_null_access();
	r5 = r2->length;
	if( r3 != r5 ) goto label$28664a1_1_71;
	r4 = ((Enumt$ctx_bc67316*)r0)->p4;
	if( r4 == NULL ) hl_null_access();
	r2 = ((Enumt$ctx_bc67316*)r0)->p6;
	kha_Image_setMipmaps(r4,r2);
	r11 = ((Enumt$ctx_bc67316*)r0)->p3;
	if( r11 == NULL ) hl_null_access();
	r2 = NULL;
	r11->mipmaps = r2;
	r11 = ((Enumt$ctx_bc67316*)r0)->p3;
	if( r11 == NULL ) hl_null_access();
	r12 = false;
	r13 = hl_alloc_dynbool(r12);
	r11->generate_mipmaps = r13;
	r8 = ((Enumt$ctx_bc67316*)r0)->p2;
	if( r8 == NULL ) hl_null_access();
	r3 = 0;
	r5 = r8->length;
	if( ((unsigned)r3) < ((unsigned)r5) ) goto label$28664a1_1_57;
	r3 = 0;
	goto label$28664a1_1_61;
	label$28664a1_1_57:
	r9 = r8->bytes;
	r5 = 2;
	r5 = r3 << r5;
	r3 = *(int*)(r9 + r5);
	label$28664a1_1_61:
	r14 = ((Enumt$ctx_bc67316*)r0)->p0;
	if( r14 == NULL ) hl_null_access();
	r2 = r14->bind_textures;
	if( r2 == NULL ) hl_null_access();
	r5 = r2->length;
	if( r3 != r5 ) goto label$28664a1_1_71;
	r15 = ((Enumt$ctx_bc67316*)r0)->p1;
	if( r15 == NULL ) hl_null_access();
	r16 = ((Enumt$ctx_bc67316*)r0)->p5;
	r15->hasValue ? ((void (*)(vdynamic*,iron__data__MaterialContext))r15->fun)((vdynamic*)r15->value,r16) : ((void (*)(iron__data__MaterialContext))r15->fun)(r16);
	label$28664a1_1_71:
	return;
}

void iron_data_MaterialContext_new__$1(venum* r0,kha__Image r1) {
	bool *r23;
	String r16, r24;
	kha__Image r5;
	hl__types__ArrayObj r2, r14;
	venum *r19;
	hl_type *r13;
	iron__data__MaterialContext r3;
	bool r26;
	iron__data__TMaterialContext r20;
	hl__types__ArrayBytes_Int r9, r22;
	iron__data__TBindTexture r12;
	vclosure *r18, *r21;
	vdynamic *r17, *r25, *r27;
	vbyte *r10;
	varray *r8;
	int r4, r6, r11, r15;
	r3 = ((Enumt$ctx_bff41cf*)r0)->p5;
	if( r3 == NULL ) hl_null_access();
	r2 = r3->textures;
	if( r2 == NULL ) hl_null_access();
	r4 = ((Enumt$ctx_bff41cf*)r0)->p3;
	r6 = r2->length;
	if( ((unsigned)r4) < ((unsigned)r6) ) goto label$28664a1_2_8;
	hl_types_ArrayObj___expand(r2,r4);
	label$28664a1_2_8:
	r8 = r2->array;
	((kha__Image*)(r8 + 1))[r4] = r1;
	r9 = ((Enumt$ctx_bff41cf*)r0)->p2;
	if( r9 == NULL ) hl_null_access();
	r4 = 0;
	r6 = r9->length;
	if( ((unsigned)r4) < ((unsigned)r6) ) goto label$28664a1_2_16;
	hl_types_ArrayBytes_Int___expand(r9,r4);
	label$28664a1_2_16:
	r10 = r9->bytes;
	r6 = 2;
	r6 = r4 << r6;
	r11 = *(int*)(r10 + r6);
	++r11;
	*(int*)(r10 + r6) = r11;
	r12 = ((Enumt$ctx_bff41cf*)r0)->p4;
	if( r12 == NULL ) hl_null_access();
	r2 = r12->mipmaps;
	if( !r2 ) goto label$28664a1_2_94;
	r13 = &t$kha_Image;
	r4 = 0;
	r8 = hl_alloc_array(r13,r4);
	r2 = hl_types_ArrayObj_alloc(r8);
	label$28664a1_2_30:
	if( r2 == NULL ) hl_null_access();
	r4 = r2->length;
	r12 = ((Enumt$ctx_bff41cf*)r0)->p4;
	if( r12 == NULL ) hl_null_access();
	r14 = r12->mipmaps;
	if( r14 == NULL ) hl_null_access();
	r6 = r14->length;
	if( r4 >= r6 ) goto label$28664a1_2_42;
	r5 = NULL;
	r4 = hl_types_ArrayObj_push(r2,((vdynamic*)r5));
	goto label$28664a1_2_30;
	label$28664a1_2_42:
	r4 = 4;
	r10 = hl_alloc_bytes(r4);
	r4 = 0;
	r6 = 0;
	r11 = 2;
	r11 = r4 << r11;
	*(int*)(r10 + r11) = r6;
	++r4;
	r4 = 1;
	r9 = hl_types_ArrayBase_allocI32(r10,r4);
	r4 = 0;
	r12 = ((Enumt$ctx_bff41cf*)r0)->p4;
	if( r12 == NULL ) hl_null_access();
	r14 = r12->mipmaps;
	if( r14 == NULL ) hl_null_access();
	r6 = r14->length;
	label$28664a1_2_58:
	if( r4 >= r6 ) goto label$28664a1_2_93;
	r11 = r4;
	++r4;
	r12 = ((Enumt$ctx_bff41cf*)r0)->p4;
	if( r12 == NULL ) hl_null_access();
	r14 = r12->mipmaps;
	if( r14 == NULL ) hl_null_access();
	r15 = r14->length;
	if( ((unsigned)r11) < ((unsigned)r15) ) goto label$28664a1_2_70;
	r16 = NULL;
	goto label$28664a1_2_73;
	label$28664a1_2_70:
	r8 = r14->array;
	r17 = ((vdynamic**)(r8 + 1))[r11];
	r16 = (String)r17;
	label$28664a1_2_73:
	r19 = hl_alloc_enum(&t$ctx_bc67316,0);
	r20 = ((Enumt$ctx_bff41cf*)r0)->p0;
	((Enumt$ctx_bc67316*)r19)->p0 = (iron__data__TMaterialContext)r20;
	r21 = ((Enumt$ctx_bff41cf*)r0)->p1;
	((Enumt$ctx_bc67316*)r19)->p1 = (vclosure*)r21;
	r22 = ((Enumt$ctx_bff41cf*)r0)->p2;
	((Enumt$ctx_bc67316*)r19)->p2 = (hl__types__ArrayBytes_Int)r22;
	r12 = ((Enumt$ctx_bff41cf*)r0)->p4;
	((Enumt$ctx_bc67316*)r19)->p3 = (iron__data__TBindTexture)r12;
	((Enumt$ctx_bc67316*)r19)->p4 = (kha__Image)r1;
	r3 = ((Enumt$ctx_bff41cf*)r0)->p5;
	((Enumt$ctx_bc67316*)r19)->p5 = (iron__data__MaterialContext)r3;
	((Enumt$ctx_bc67316*)r19)->p6 = (hl__types__ArrayObj)r2;
	((Enumt$ctx_bc67316*)r19)->p7 = (hl__types__ArrayBytes_Int)r9;
	((Enumt$ctx_bc67316*)r19)->p8 = (int)r11;
	r18 = hl_alloc_closure_ptr(&t$fun_29746a5,iron_data_MaterialContext_new__$2,r19);
	r23 = NULL;
	r24 = NULL;
	iron_data_Data_getImage(r16,r18,r23,r24);
	goto label$28664a1_2_58;
	label$28664a1_2_93:
	goto label$28664a1_2_156;
	label$28664a1_2_94:
	r12 = ((Enumt$ctx_bff41cf*)r0)->p4;
	if( r12 == NULL ) hl_null_access();
	r25 = r12->generate_mipmaps;
	r26 = true;
	r27 = hl_alloc_dynbool(r26);
	if( r25 != r27 && (!r25 || !r27 || (r25->v.b != r27->v.b)) ) goto label$28664a1_2_135;
	if( !r1 ) goto label$28664a1_2_135;
	if( r1 == NULL ) hl_null_access();
	r4 = 1000;
	kha_Image_generateMipmaps(r1,r4);
	r12 = ((Enumt$ctx_bff41cf*)r0)->p4;
	if( r12 == NULL ) hl_null_access();
	r2 = NULL;
	r12->mipmaps = r2;
	r12 = ((Enumt$ctx_bff41cf*)r0)->p4;
	if( r12 == NULL ) hl_null_access();
	r26 = false;
	r25 = hl_alloc_dynbool(r26);
	r12->generate_mipmaps = r25;
	r9 = ((Enumt$ctx_bff41cf*)r0)->p2;
	if( r9 == NULL ) hl_null_access();
	r4 = 0;
	r6 = r9->length;
	if( ((unsigned)r4) < ((unsigned)r6) ) goto label$28664a1_2_120;
	r4 = 0;
	goto label$28664a1_2_124;
	label$28664a1_2_120:
	r10 = r9->bytes;
	r6 = 2;
	r6 = r4 << r6;
	r4 = *(int*)(r10 + r6);
	label$28664a1_2_124:
	r20 = ((Enumt$ctx_bff41cf*)r0)->p0;
	if( r20 == NULL ) hl_null_access();
	r2 = r20->bind_textures;
	if( r2 == NULL ) hl_null_access();
	r6 = r2->length;
	if( r4 != r6 ) goto label$28664a1_2_134;
	r21 = ((Enumt$ctx_bff41cf*)r0)->p1;
	if( r21 == NULL ) hl_null_access();
	r3 = ((Enumt$ctx_bff41cf*)r0)->p5;
	r21->hasValue ? ((void (*)(vdynamic*,iron__data__MaterialContext))r21->fun)((vdynamic*)r21->value,r3) : ((void (*)(iron__data__MaterialContext))r21->fun)(r3);
	label$28664a1_2_134:
	goto label$28664a1_2_156;
	label$28664a1_2_135:
	r9 = ((Enumt$ctx_bff41cf*)r0)->p2;
	if( r9 == NULL ) hl_null_access();
	r4 = 0;
	r6 = r9->length;
	if( ((unsigned)r4) < ((unsigned)r6) ) goto label$28664a1_2_142;
	r4 = 0;
	goto label$28664a1_2_146;
	label$28664a1_2_142:
	r10 = r9->bytes;
	r6 = 2;
	r6 = r4 << r6;
	r4 = *(int*)(r10 + r6);
	label$28664a1_2_146:
	r20 = ((Enumt$ctx_bff41cf*)r0)->p0;
	if( r20 == NULL ) hl_null_access();
	r2 = r20->bind_textures;
	if( r2 == NULL ) hl_null_access();
	r6 = r2->length;
	if( r4 != r6 ) goto label$28664a1_2_156;
	r21 = ((Enumt$ctx_bff41cf*)r0)->p1;
	if( r21 == NULL ) hl_null_access();
	r3 = ((Enumt$ctx_bff41cf*)r0)->p5;
	r21->hasValue ? ((void (*)(vdynamic*,iron__data__MaterialContext))r21->fun)((vdynamic*)r21->value,r3) : ((void (*)(iron__data__MaterialContext))r21->fun)(r3);
	label$28664a1_2_156:
	return;
}

void iron_data_MaterialContext_setTextureParameters(iron__data__MaterialContext r0,vvirtual* r1,int r2,iron__data__ShaderContext r3,int r4) {
	hl__types__ArrayObj r6;
	iron__data__TMaterialContext r7;
	iron__data__TBindTexture r9;
	vdynamic *r10;
	varray *r11;
	int r8;
	if( r3 == NULL ) hl_null_access();
	r7 = r0->raw;
	if( r7 == NULL ) hl_null_access();
	r6 = r7->bind_textures;
	if( r6 == NULL ) hl_null_access();
	r8 = r6->length;
	if( ((unsigned)r2) < ((unsigned)r8) ) goto label$28664a1_3_9;
	r9 = NULL;
	goto label$28664a1_3_12;
	label$28664a1_3_9:
	r11 = r6->array;
	r10 = ((vdynamic**)(r11 + 1))[r2];
	r9 = (iron__data__TBindTexture)r10;
	label$28664a1_3_12:
	iron_data_ShaderContext_setTextureParameters(r3,r1,r4,r9);
	return;
}

void iron_data_MaterialContext_new(iron__data__MaterialContext r0,iron__data__TMaterialContext r1,vclosure* r2) {
	bool *r27;
	String r21, r22;
	kha__Image r14;
	hl__types__ArrayObj r4, r12;
	venum *r25;
	hl_type *r10;
	iron__data__MaterialContext r5;
	bool r26;
	hl__types__ArrayBytes_Int r15;
	iron__data__TBindTexture r20;
	vclosure *r24;
	vdynamic *r13;
	iron__data__$MaterialContext r7;
	vbyte *r16;
	varray *r9;
	int r3, r8, r11, r17, r18, r19, r23;
	r3 = 0;
	r0->id = r3;
	r4 = NULL;
	r0->textures = r4;
	r5 = r0;
	r0->raw = r1;
	r7 = (iron__data__$MaterialContext)g$_iron_data_MaterialContext;
	r3 = r7->num;
	r8 = r3;
	++r3;
	r7->num = r3;
	r0->id = r8;
	if( r1 == NULL ) hl_null_access();
	r4 = r1->bind_textures;
	if( !r4 ) goto label$28664a1_4_121;
	r4 = r1->bind_textures;
	if( r4 == NULL ) hl_null_access();
	r3 = r4->length;
	r8 = 0;
	if( r8 >= r3 ) goto label$28664a1_4_121;
	r4 = r1->bind_textures;
	if( r4 == NULL ) hl_null_access();
	r3 = r4->length;
	r10 = &t$kha_Image;
	r8 = 0;
	r9 = hl_alloc_array(r10,r8);
	r4 = hl_types_ArrayObj_alloc(r9);
	r11 = 0;
	if( r11 >= r3 ) goto label$28664a1_4_39;
	if( r4 == NULL ) hl_null_access();
	r11 = 1;
	r8 = r3 - r11;
	r13 = NULL;
	r14 = (kha__Image)hl_dyn_castp(&r13,&t$_dyn,&t$kha_Image);
	r11 = r4->length;
	if( ((unsigned)r8) < ((unsigned)r11) ) goto label$28664a1_4_37;
	hl_types_ArrayObj___expand(r4,r8);
	label$28664a1_4_37:
	r9 = r4->array;
	((kha__Image*)(r9 + 1))[r8] = r14;
	label$28664a1_4_39:
	r0->textures = r4;
	r8 = 4;
	r16 = hl_alloc_bytes(r8);
	r8 = 0;
	r11 = 0;
	r17 = 2;
	r17 = r8 << r17;
	*(int*)(r16 + r17) = r11;
	++r8;
	r8 = 1;
	r15 = hl_types_ArrayBase_allocI32(r16,r8);
	r8 = 0;
	r12 = r1->bind_textures;
	if( r12 == NULL ) hl_null_access();
	r11 = r12->length;
	label$28664a1_4_54:
	if( r8 >= r11 ) goto label$28664a1_4_120;
	r17 = r8;
	++r8;
	if( r1 == NULL ) hl_null_access();
	r12 = r1->bind_textures;
	if( r12 == NULL ) hl_null_access();
	r19 = r12->length;
	if( ((unsigned)r17) < ((unsigned)r19) ) goto label$28664a1_4_65;
	r20 = NULL;
	goto label$28664a1_4_68;
	label$28664a1_4_65:
	r9 = r12->array;
	r13 = ((vdynamic**)(r9 + 1))[r17];
	r20 = (iron__data__TBindTexture)r13;
	label$28664a1_4_68:
	if( r20 == NULL ) hl_null_access();
	r21 = r20->file;
	r22 = (String)s$;
	if( r21 == r22 || (r21 && r22 && String___compare(r21,(vdynamic*)r22) == 0) ) goto label$28664a1_4_75;
	r21 = r20->source;
	r22 = (String)s$movie;
	if( r21 != r22 && (!r21 || !r22 || String___compare(r21,(vdynamic*)r22) != 0) ) goto label$28664a1_4_102;
	label$28664a1_4_75:
	if( r15 == NULL ) hl_null_access();
	r18 = 0;
	r19 = r15->length;
	if( ((unsigned)r18) < ((unsigned)r19) ) goto label$28664a1_4_80;
	hl_types_ArrayBytes_Int___expand(r15,r18);
	label$28664a1_4_80:
	r16 = r15->bytes;
	r19 = 2;
	r19 = r18 << r19;
	r23 = *(int*)(r16 + r19);
	++r23;
	*(int*)(r16 + r19) = r23;
	r18 = 0;
	r19 = r15->length;
	if( ((unsigned)r18) < ((unsigned)r19) ) goto label$28664a1_4_91;
	r18 = 0;
	goto label$28664a1_4_95;
	label$28664a1_4_91:
	r16 = r15->bytes;
	r19 = 2;
	r19 = r18 << r19;
	r18 = *(int*)(r16 + r19);
	label$28664a1_4_95:
	r12 = r1->bind_textures;
	if( r12 == NULL ) hl_null_access();
	r19 = r12->length;
	if( r18 != r19 ) goto label$28664a1_4_101;
	if( r2 == NULL ) hl_null_access();
	r2->hasValue ? ((void (*)(vdynamic*,iron__data__MaterialContext))r2->fun)((vdynamic*)r2->value,r0) : ((void (*)(iron__data__MaterialContext))r2->fun)(r0);
	label$28664a1_4_101:
	goto label$28664a1_4_54;
	label$28664a1_4_102:
	r21 = r20->file;
	r25 = hl_alloc_enum(&t$ctx_bff41cf,0);
	((Enumt$ctx_bff41cf*)r25)->p0 = (iron__data__TMaterialContext)r1;
	((Enumt$ctx_bff41cf*)r25)->p1 = (vclosure*)r2;
	((Enumt$ctx_bff41cf*)r25)->p2 = (hl__types__ArrayBytes_Int)r15;
	((Enumt$ctx_bff41cf*)r25)->p3 = (int)r17;
	((Enumt$ctx_bff41cf*)r25)->p4 = (iron__data__TBindTexture)r20;
	((Enumt$ctx_bff41cf*)r25)->p5 = (iron__data__MaterialContext)r5;
	r24 = hl_alloc_closure_ptr(&t$fun_c4af003,iron_data_MaterialContext_new__$1,r25);
	r26 = false;
	r27 = &r26;
	r22 = r20->format;
	if( !r22 ) goto label$28664a1_4_117;
	r22 = r20->format;
	goto label$28664a1_4_118;
	label$28664a1_4_117:
	r22 = (String)s$RGBA32;
	label$28664a1_4_118:
	iron_data_Data_getImage(r21,r24,r27,r22);
	goto label$28664a1_4_54;
	label$28664a1_4_120:
	goto label$28664a1_4_123;
	label$28664a1_4_121:
	if( r2 == NULL ) hl_null_access();
	r2->hasValue ? ((void (*)(vdynamic*,iron__data__MaterialContext))r2->fun)((vdynamic*)r2->value,r0) : ((void (*)(iron__data__MaterialContext))r2->fun)(r0);
	label$28664a1_4_123:
	return;
}


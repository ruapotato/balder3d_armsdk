// Generated by HLC 4.2.5 (HL v4)
#define HLC_BOOT
#include <hlc.h>
#include <kha/Image.h>
kha__Image kha_Image_create2(int,int,int,bool,bool,int);
kha__Image kha_Image_create3(int,int,int,int,bool,int);
#include <haxe/io/BytesDataImpl.h>
extern hl_type t$kha_Image;
void kha_Image_new(kha__Image,bool);
extern hl_type t$haxe_io_BytesDataImpl;
void haxe_io_BytesDataImpl_new(haxe__io__BytesDataImpl,vbyte*,int);
int kha_Image_getTextureFormat(int);
void kha_Image_initFromBytes(kha__Image,haxe__io__BytesDataImpl,int,int,int);
#include <hl/natives.h>
void kha_Image_initFromBytes3D(kha__Image,haxe__io__BytesDataImpl,int,int,int,int);
void kha_Image_initRenderTarget(kha__Image,int,int,int,int,int);
void kha_Image_init(kha__Image,int,int,int);
void kha_Image_init3D(kha__Image,int,int,int,int);
extern String s$_hdr;
bool StringTools_endsWith(String,String);
void kha_Image_initFromFile(kha__Image,String);
#include <kha/korehl/graphics4/Graphics2.h>
extern hl_type t$kha_korehl_graphics4_Graphics2;
extern hl_type t$vrt_7ced7cf;
void kha_korehl_graphics4_Graphics2_new(kha__korehl__graphics4__Graphics2,vvirtual*);
#include <kha/korehl/graphics4/Graphics.h>
extern hl_type t$kha_korehl_graphics4_Graphics;
void kha_korehl_graphics4_Graphics_new(kha__korehl__graphics4__Graphics,vvirtual*);
extern hl_type t$vrt_779b131;
int kha_Image_formatByteSize(int);
haxe__io__Bytes haxe_io_Bytes_alloc(int);

kha__Image kha_Image_create(int r0,int r1,vdynamic* r2,vdynamic* r3,bool* r4) {
	kha__Image r6;
	bool r5, r8;
	int r7, r9;
	if( r4 ) goto label$2991a06_1_3;
	r5 = false;
	goto label$2991a06_1_4;
	label$2991a06_1_3:
	r5 = *r4;
	label$2991a06_1_4:
	if( r2 ) goto label$2991a06_1_7;
	r7 = 0;
	goto label$2991a06_1_8;
	label$2991a06_1_7:
	r7 = r2 ? r2->v.i : 0;
	label$2991a06_1_8:
	r8 = false;
	r9 = 0;
	r6 = kha_Image_create2(r0,r1,r7,r5,r8,r9);
	return r6;
}

kha__Image kha_Image_create3D(int r0,int r1,int r2,vdynamic* r3,vdynamic* r4,bool* r5) {
	kha__Image r7;
	bool r6;
	int r8, r9;
	if( r5 ) goto label$2991a06_2_3;
	r6 = false;
	goto label$2991a06_2_4;
	label$2991a06_2_3:
	r6 = *r5;
	label$2991a06_2_4:
	if( r3 ) goto label$2991a06_2_7;
	r8 = 0;
	goto label$2991a06_2_8;
	label$2991a06_2_7:
	r8 = r3 ? r3->v.i : 0;
	label$2991a06_2_8:
	r9 = 0;
	r7 = kha_Image_create3(r0,r1,r2,r8,r6,r9);
	return r7;
}

kha__Image kha_Image_createRenderTarget(int r0,int r1,vdynamic* r2,int* r3,int* r4) {
	kha__Image r7;
	bool r9, r10;
	int r5, r6, r8;
	if( r3 ) goto label$2991a06_3_3;
	r5 = 0;
	goto label$2991a06_3_4;
	label$2991a06_3_3:
	r5 = *r3;
	label$2991a06_3_4:
	if( r4 ) goto label$2991a06_3_7;
	r6 = 1;
	goto label$2991a06_3_8;
	label$2991a06_3_7:
	r6 = *r4;
	label$2991a06_3_8:
	if( r2 ) goto label$2991a06_3_11;
	r8 = 0;
	goto label$2991a06_3_12;
	label$2991a06_3_11:
	r8 = r2 ? r2->v.i : 0;
	label$2991a06_3_12:
	r9 = false;
	r10 = true;
	r7 = kha_Image_create2(r0,r1,r8,r9,r10,r5);
	return r7;
}

kha__Image kha_Image_fromBytes(haxe__io__Bytes r0,int r1,int r2,vdynamic* r3,vdynamic* r4,bool* r5) {
	kha__Image r7;
	bool r6;
	haxe__io__BytesDataImpl r10;
	vbyte *r11;
	int r9, r12;
	if( r5 ) goto label$2991a06_4_3;
	r6 = false;
	goto label$2991a06_4_4;
	label$2991a06_4_3:
	r6 = *r5;
	label$2991a06_4_4:
	r7 = (kha__Image)hl_alloc_obj(&t$kha_Image);
	kha_Image_new(r7,r6);
	r9 = r3 ? r3->v.i : 0;
	r7->myFormat = r9;
	r10 = (haxe__io__BytesDataImpl)hl_alloc_obj(&t$haxe_io_BytesDataImpl);
	if( r0 == NULL ) hl_null_access();
	r11 = r0->b;
	r9 = r0->length;
	haxe_io_BytesDataImpl_new(r10,r11,r9);
	r12 = r3 ? r3->v.i : 0;
	r12 = kha_Image_getTextureFormat(r12);
	kha_Image_initFromBytes(r7,r10,r1,r2,r12);
	return r7;
}

void kha_Image_initFromBytes(kha__Image r0,haxe__io__BytesDataImpl r1,int r2,int r3,int r4) {
	bool r6;
	vbyte *r5;
	if( r1 == NULL ) hl_null_access();
	r5 = r1->bytes;
	r6 = r0->readable;
	r5 = hl_kinc_texture_from_bytes(r5,r2,r3,r4,r6);
	r0->_texture = r5;
	return;
}

kha__Image kha_Image_fromBytes3D(haxe__io__Bytes r0,int r1,int r2,int r3,vdynamic* r4,vdynamic* r5,bool* r6) {
	kha__Image r8;
	bool r7;
	haxe__io__BytesDataImpl r11;
	vbyte *r12;
	int r10, r13;
	if( r6 ) goto label$2991a06_6_3;
	r7 = false;
	goto label$2991a06_6_4;
	label$2991a06_6_3:
	r7 = *r6;
	label$2991a06_6_4:
	r8 = (kha__Image)hl_alloc_obj(&t$kha_Image);
	kha_Image_new(r8,r7);
	r10 = r4 ? r4->v.i : 0;
	r8->myFormat = r10;
	r11 = (haxe__io__BytesDataImpl)hl_alloc_obj(&t$haxe_io_BytesDataImpl);
	if( r0 == NULL ) hl_null_access();
	r12 = r0->b;
	r10 = r0->length;
	haxe_io_BytesDataImpl_new(r11,r12,r10);
	r13 = r4 ? r4->v.i : 0;
	r13 = kha_Image_getTextureFormat(r13);
	kha_Image_initFromBytes3D(r8,r11,r1,r2,r3,r13);
	return r8;
}

void kha_Image_initFromBytes3D(kha__Image r0,haxe__io__BytesDataImpl r1,int r2,int r3,int r4,int r5) {
	bool r7;
	vbyte *r6;
	if( r1 == NULL ) hl_null_access();
	r6 = r1->bytes;
	r7 = r0->readable;
	r6 = hl_kinc_texture_from_bytes3d(r6,r2,r3,r4,r5,r7);
	r0->_texture = r6;
	return;
}

int kha_Image_getRenderTargetFormat(int r0) {
	int r1;
	switch(r0) {
		default:
		case 1:
			r1 = 0;
			return r1;
		case 0:
			r1 = 0;
			return r1;
		case 2:
			r1 = 3;
			return r1;
		case 3:
			r1 = 4;
			return r1;
		case 4:
			r1 = 1;
			return r1;
	}
}

int kha_Image_getDepthBufferBits(int r0) {
	int r1;
	switch(r0) {
		default:
			goto label$2991a06_9_14;
		case 0:
			r1 = -1;
			return r1;
		case 1:
			r1 = 24;
			return r1;
		case 2:
			r1 = 24;
			return r1;
		case 3:
			r1 = 24;
			return r1;
		case 4:
			r1 = 32;
			return r1;
		case 5:
			r1 = 16;
			return r1;
	}
	label$2991a06_9_14:
	r1 = 0;
	return r1;
}

int kha_Image_getStencilBufferBits(int r0) {
	int r1;
	switch(r0) {
		default:
			goto label$2991a06_10_14;
		case 0:
			r1 = -1;
			return r1;
		case 1:
			r1 = -1;
			return r1;
		case 2:
			r1 = 8;
			return r1;
		case 3:
			r1 = 8;
			return r1;
		case 4:
			r1 = 8;
			return r1;
		case 5:
			r1 = 0;
			return r1;
	}
	label$2991a06_10_14:
	r1 = 0;
	return r1;
}

int kha_Image_getTextureFormat(int r0) {
	int r1;
	switch(r0) {
		default:
		case 1:
		case 3:
			r1 = 1;
			return r1;
		case 0:
			r1 = 0;
			return r1;
		case 2:
			r1 = 3;
			return r1;
		case 4:
			r1 = 4;
			return r1;
		case 5:
			r1 = 5;
			return r1;
		case 6:
			r1 = 7;
			return r1;
	}
}

kha__Image kha_Image_create2(int r0,int r1,int r2,bool r3,bool r4,int r5) {
	kha__Image r6;
	int r8, r9, r10;
	r6 = (kha__Image)hl_alloc_obj(&t$kha_Image);
	kha_Image_new(r6,r3);
	r6->myFormat = r2;
	if( !r4 ) goto label$2991a06_12_9;
	r8 = kha_Image_getDepthBufferBits(r5);
	r9 = kha_Image_getRenderTargetFormat(r2);
	r10 = kha_Image_getStencilBufferBits(r5);
	kha_Image_initRenderTarget(r6,r0,r1,r8,r9,r10);
	goto label$2991a06_12_10;
	label$2991a06_12_9:
	kha_Image_init(r6,r0,r1,r2);
	label$2991a06_12_10:
	return r6;
}

kha__Image kha_Image_create3(int r0,int r1,int r2,int r3,bool r4,int r5) {
	kha__Image r6;
	int r8;
	r6 = (kha__Image)hl_alloc_obj(&t$kha_Image);
	kha_Image_new(r6,r4);
	r6->myFormat = r3;
	r8 = kha_Image_getTextureFormat(r3);
	kha_Image_init3D(r6,r0,r1,r2,r8);
	return r6;
}

void kha_Image_initRenderTarget(kha__Image r0,int r1,int r2,int r3,int r4,int r5) {
	vbyte *r6;
	r6 = hl_kinc_render_target_create(r1,r2,r3,r4,r5);
	r0->_renderTarget = r6;
	r6 = NULL;
	r0->_texture = r6;
	return;
}

void kha_Image_init(kha__Image r0,int r1,int r2,int r3) {
	bool r5;
	vbyte *r4;
	r5 = r0->readable;
	r4 = hl_kinc_texture_create(r1,r2,r3,r5);
	r0->_texture = r4;
	r4 = NULL;
	r0->_renderTarget = r4;
	return;
}

void kha_Image_init3D(kha__Image r0,int r1,int r2,int r3,int r4) {
	bool r6;
	vbyte *r5;
	r6 = r0->readable;
	r5 = hl_kinc_texture_create3d(r1,r2,r3,r4,r6);
	r0->_texture = r5;
	r5 = NULL;
	r0->_renderTarget = r5;
	return;
}

kha__Image kha_Image_fromFile(String r0,bool r1) {
	String r5;
	kha__Image r2, r6;
	bool r3;
	vbyte *r8;
	int r7;
	r2 = (kha__Image)hl_alloc_obj(&t$kha_Image);
	kha_Image_new(r2,r1);
	r5 = (String)s$_hdr;
	r3 = StringTools_endsWith(r0,r5);
	if( !r3 ) goto label$2991a06_17_7;
	r7 = 2;
	goto label$2991a06_17_8;
	label$2991a06_17_7:
	r7 = 0;
	label$2991a06_17_8:
	r2->myFormat = r7;
	kha_Image_initFromFile(r2,r0);
	r8 = r2->_texture;
	if( r8 ) goto label$2991a06_17_14;
	r6 = NULL;
	return r6;
	label$2991a06_17_14:
	return r2;
}

void kha_Image_initFromFile(kha__Image r0,String r1) {
	bool r8;
	int *r5;
	vbyte *r4, *r6;
	int r2, r7;
	r2 = 0;
	if( r1 == NULL ) hl_null_access();
	r4 = r1->bytes;
	r5 = &r2;
	r7 = 0;
	r6 = hl_utf16_to_utf8(r4,r7,r5);
	r8 = r0->readable;
	r6 = hl_kinc_texture_create_from_file(r6,r8);
	r0->_texture = r6;
	r6 = NULL;
	r0->_renderTarget = r6;
	return;
}

kha__graphics2__Graphics kha_Image_get_g2(kha__Image r0) {
	kha__korehl__graphics4__Graphics2 r3;
	vvirtual *r4;
	kha__graphics2__Graphics r2;
	r2 = r0->graphics2;
	if( r2 ) goto label$2991a06_19_6;
	r3 = (kha__korehl__graphics4__Graphics2)hl_alloc_obj(&t$kha_korehl_graphics4_Graphics2);
	r4 = hl_to_virtual(&t$vrt_7ced7cf,(vdynamic*)r0);
	kha_korehl_graphics4_Graphics2_new(r3,r4);
	r0->graphics2 = ((kha__graphics2__Graphics)r3);
	label$2991a06_19_6:
	r2 = r0->graphics2;
	return r2;
}

vvirtual* kha_Image_get_g4(kha__Image r0) {
	vvirtual *r2, *r4;
	kha__korehl__graphics4__Graphics r3;
	r2 = r0->graphics4;
	if( r2 ) goto label$2991a06_20_13;
	r3 = (kha__korehl__graphics4__Graphics)hl_alloc_obj(&t$kha_korehl_graphics4_Graphics);
	r4 = hl_to_virtual(&t$vrt_7ced7cf,(vdynamic*)r0);
	kha_korehl_graphics4_Graphics_new(r3,r4);
	if( r3 ) goto label$2991a06_20_8;
	r2 = NULL;
	goto label$2991a06_20_12;
	label$2991a06_20_8:
	r2 = r3->f$1;
	if( r2 ) goto label$2991a06_20_12;
	r2 = hl_to_virtual(&t$vrt_779b131,(vdynamic*)r3);
	r3->f$1 = r2;
	label$2991a06_20_12:
	r0->graphics4 = r2;
	label$2991a06_20_13:
	r2 = r0->graphics4;
	return r2;
}

bool kha_Image_get_nonPow2Supported() {
	bool r0;
	r0 = hl_kinc_non_pow2_textures_supported();
	return r0;
}

bool kha_Image_renderTargetsInvertedY() {
	bool r0;
	r0 = hl_kinc_graphics_render_targets_inverted_y();
	return r0;
}

int kha_Image_get_width(kha__Image r0) {
	int r2;
	vbyte *r1;
	r1 = r0->_texture;
	if( !r1 ) goto label$2991a06_23_5;
	r1 = r0->_texture;
	r2 = hl_kinc_texture_get_width(r1);
	return r2;
	label$2991a06_23_5:
	r1 = r0->_renderTarget;
	r2 = hl_kinc_render_target_get_width(r1);
	return r2;
}

int kha_Image_get_height(kha__Image r0) {
	int r2;
	vbyte *r1;
	r1 = r0->_texture;
	if( !r1 ) goto label$2991a06_24_5;
	r1 = r0->_texture;
	r2 = hl_kinc_texture_get_height(r1);
	return r2;
	label$2991a06_24_5:
	r1 = r0->_renderTarget;
	r2 = hl_kinc_render_target_get_height(r1);
	return r2;
}

int kha_Image_get_depth(kha__Image r0) {
	int r1;
	r1 = 1;
	return r1;
}

int kha_Image_get_realWidth(kha__Image r0) {
	int r2;
	vbyte *r1;
	r1 = r0->_texture;
	if( !r1 ) goto label$2991a06_26_5;
	r1 = r0->_texture;
	r2 = hl_kinc_texture_get_real_width(r1);
	return r2;
	label$2991a06_26_5:
	r1 = r0->_renderTarget;
	r2 = hl_kinc_render_target_get_real_width(r1);
	return r2;
}

int kha_Image_get_realHeight(kha__Image r0) {
	int r2;
	vbyte *r1;
	r1 = r0->_texture;
	if( !r1 ) goto label$2991a06_27_5;
	r1 = r0->_texture;
	r2 = hl_kinc_texture_get_real_height(r1);
	return r2;
	label$2991a06_27_5:
	r1 = r0->_renderTarget;
	r2 = hl_kinc_render_target_get_real_height(r1);
	return r2;
}

void kha_Image_unload(kha__Image r0) {
	vbyte *r2;
	r2 = r0->_texture;
	if( !r2 ) goto label$2991a06_28_5;
	r2 = r0->_texture;
	hl_kinc_texture_unload(r2);
	goto label$2991a06_28_7;
	label$2991a06_28_5:
	r2 = r0->_renderTarget;
	hl_kinc_render_target_unload(r2);
	label$2991a06_28_7:
	return;
}

haxe__io__Bytes kha_Image_lock(kha__Image r0,int* r1) {
	haxe__io__Bytes r3;
	int r2, r4, r5;
	if( r1 ) goto label$2991a06_29_3;
	r2 = 0;
	goto label$2991a06_29_4;
	label$2991a06_29_3:
	r2 = *r1;
	label$2991a06_29_4:
	r4 = r0->myFormat;
	r4 = kha_Image_formatByteSize(r4);
	r5 = kha_Image_get_width(r0);
	r4 = r4 * r5;
	r5 = kha_Image_get_height(r0);
	r4 = r4 * r5;
	r3 = haxe_io_Bytes_alloc(r4);
	r0->bytes = r3;
	r3 = r0->bytes;
	return r3;
}

void kha_Image_unlock(kha__Image r0) {
	haxe__io__Bytes r3, r6;
	haxe__io__BytesDataImpl r4;
	int r7;
	vbyte *r1, *r5, *r8;
	r1 = r0->_texture;
	r3 = r0->bytes;
	r4 = (haxe__io__BytesDataImpl)hl_alloc_obj(&t$haxe_io_BytesDataImpl);
	if( r3 == NULL ) hl_null_access();
	r5 = r3->b;
	r7 = r3->length;
	haxe_io_BytesDataImpl_new(r4,r5,r7);
	r8 = r4->bytes;
	hl_kinc_texture_unlock(r1,r8);
	r6 = NULL;
	r0->bytes = r6;
	return;
}

int kha_Image_formatByteSize(int r0) {
	int r1;
	switch(r0) {
		default:
			r1 = 4;
			return r1;
		case 0:
			r1 = 4;
			return r1;
		case 1:
			r1 = 1;
			return r1;
		case 2:
			r1 = 16;
			return r1;
		case 3:
			r1 = 2;
			return r1;
		case 4:
			r1 = 8;
			return r1;
		case 5:
			r1 = 4;
			return r1;
		case 6:
			r1 = 2;
			return r1;
	}
}

void kha_Image_generateMipmaps(kha__Image r0,int r1) {
	vbyte *r3;
	r3 = r0->_texture;
	if( !r3 ) goto label$2991a06_32_5;
	r3 = r0->_texture;
	hl_kinc_generate_mipmaps_texture(r3,r1);
	goto label$2991a06_32_7;
	label$2991a06_32_5:
	r3 = r0->_renderTarget;
	hl_kinc_generate_mipmaps_target(r3,r1);
	label$2991a06_32_7:
	return;
}

void kha_Image_setMipmaps(kha__Image r0,hl__types__ArrayObj r1) {
	kha__Image r8;
	vdynamic *r9;
	vbyte *r11, *r12;
	varray *r10;
	int r2, r4, r5, r6, r7;
	r2 = 0;
	if( r1 == NULL ) hl_null_access();
	r4 = r1->length;
	label$2991a06_33_3:
	if( r2 >= r4 ) goto label$2991a06_33_22;
	r5 = r2;
	++r2;
	if( r1 == NULL ) hl_null_access();
	r7 = r1->length;
	if( ((unsigned)r5) < ((unsigned)r7) ) goto label$2991a06_33_12;
	r8 = NULL;
	goto label$2991a06_33_15;
	label$2991a06_33_12:
	r10 = r1->array;
	r9 = ((vdynamic**)(r10 + 1))[r5];
	r8 = (kha__Image)r9;
	label$2991a06_33_15:
	r7 = 1;
	r6 = r5 + r7;
	r11 = r0->_texture;
	if( r8 == NULL ) hl_null_access();
	r12 = r8->_texture;
	hl_kinc_set_mipmap_texture(r11,r12,r6);
	goto label$2991a06_33_3;
	label$2991a06_33_22:
	return;
}

void kha_Image_setDepthStencilFrom(kha__Image r0,kha__Image r1) {
	vbyte *r3, *r4;
	int r2;
	r3 = r0->_renderTarget;
	if( r1 == NULL ) hl_null_access();
	r4 = r1->_renderTarget;
	r2 = hl_kinc_render_target_set_depth_stencil_from(r3,r4);
	return;
}

void kha_Image_new(kha__Image r0,bool r1) {
	haxe__io__Bytes r2;
	r2 = NULL;
	r0->bytes = r2;
	r0->readable = r1;
	return;
}


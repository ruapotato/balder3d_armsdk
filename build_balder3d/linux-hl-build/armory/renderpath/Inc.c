// Generated by HLC 4.2.5 (HL v4)
#define HLC_BOOT
#include <hlc.h>
#include <armory/renderpath/Inc.h>
extern armory__renderpath__$Inc g$_armory_renderpath_Inc;
#include <hl/types/ArrayObj.h>
#include <iron/Scene.h>
#include <iron/data/TLightData.h>
#include <iron/data/LightData.h>
extern iron__$Scene g$_iron_Scene;
extern String s$sun;
int String___compare(String,vdynamic*);
extern String s$shadowMap;
void iron_RenderPath_bindTarget(iron__RenderPath,String,String);
extern String s$shadowMapPoint_;
#include <hl/natives.h>
String String___alloc__(vbyte*,int);
String String___add__(String,String);
extern String s$0fbd177;
extern String s$shadowMapSpot_;
#include <haxe/ds/StringMap.h>
#include <iron/RenderTarget.h>
#include <iron/RenderTargetRaw.h>
#include <iron/object/LightObject.h>
vdynamic* haxe_ds_StringMap_get(haxe__ds__StringMap,String);
extern hl_type t$iron_RenderTargetRaw;
void iron_RenderTargetRaw_new(iron__RenderTargetRaw);
extern String s$DEPTH16;
iron__RenderTarget iron_RenderPath_createRenderTarget(iron__RenderPath,iron__RenderTargetRaw);
extern iron__object__$LightObject g$_iron_object_LightObject;
extern hl_type t$_i32;
void iron_RenderPath_setTarget(iron__RenderPath,String,hl__types__ArrayObj,double*);
extern hl_type t$_f64;
void iron_RenderPath_clearTarget(iron__RenderPath,vdynamic*,vdynamic*);
extern String s$shadowmap;
void iron_RenderPath_drawMeshes(iron__RenderPath,String);
extern String s$point;
extern String s$spot;
extern String s$area;

void armory_renderpath_Inc_init(iron__RenderPath r0) {
	armory__renderpath__$Inc r1;
	r1 = (armory__renderpath__$Inc)g$_armory_renderpath_Inc;
	r1->path = r0;
	return;
}

void armory_renderpath_Inc_bindShadowMap() {
	String r11, r14;
	iron__data__TLightData r12;
	hl__types__ArrayObj r2;
	bool r10;
	iron__$Scene r4;
	iron__Scene r3;
	iron__data__LightData r13;
	iron__object__LightObject r7;
	int *r18;
	vdynamic *r8;
	vbyte *r19;
	armory__renderpath__$Inc r16;
	iron__RenderPath r15;
	varray *r9;
	int r0, r5, r6, r17;
	r0 = 0;
	r4 = (iron__$Scene)g$_iron_Scene;
	r3 = r4->active;
	if( r3 == NULL ) hl_null_access();
	r2 = r3->lights;
	label$d589772_2_5:
	if( r2 == NULL ) hl_null_access();
	r6 = r2->length;
	if( r0 >= r6 ) goto label$d589772_2_33;
	r6 = r2->length;
	if( ((unsigned)r0) < ((unsigned)r6) ) goto label$d589772_2_13;
	r7 = NULL;
	goto label$d589772_2_16;
	label$d589772_2_13:
	r9 = r2->array;
	r8 = ((vdynamic**)(r9 + 1))[r0];
	r7 = (iron__object__LightObject)r8;
	label$d589772_2_16:
	++r0;
	if( r7 == NULL ) hl_null_access();
	r10 = r7->visible;
	if( !r10 ) goto label$d589772_2_27;
	r13 = r7->data;
	if( r13 == NULL ) hl_null_access();
	r12 = r13->raw;
	if( r12 == NULL ) hl_null_access();
	r11 = r12->type;
	r14 = (String)s$sun;
	if( r11 == r14 || (r11 && r14 && String___compare(r11,(vdynamic*)r14) == 0) ) goto label$d589772_2_28;
	label$d589772_2_27:
	goto label$d589772_2_5;
	label$d589772_2_28:
	r11 = (String)s$shadowMap;
	r16 = (armory__renderpath__$Inc)g$_armory_renderpath_Inc;
	r15 = r16->path;
	if( r15 == NULL ) hl_null_access();
	iron_RenderPath_bindTarget(r15,r11,r11);
	label$d589772_2_33:
	r0 = 0;
	r16 = (armory__renderpath__$Inc)g$_armory_renderpath_Inc;
	r5 = r16->pointIndex;
	label$d589772_2_36:
	if( r0 >= r5 ) goto label$d589772_2_53;
	r6 = r0;
	++r0;
	r11 = (String)s$shadowMapPoint_;
	r17 = r6;
	r18 = &r17;
	r19 = hl_itos(r17,r18);
	r14 = String___alloc__(r19,r17);
	r11 = String___add__(r11,r14);
	r14 = (String)s$0fbd177;
	r11 = String___add__(r11,r14);
	r16 = (armory__renderpath__$Inc)g$_armory_renderpath_Inc;
	r15 = r16->path;
	if( r15 == NULL ) hl_null_access();
	iron_RenderPath_bindTarget(r15,r11,r11);
	goto label$d589772_2_36;
	label$d589772_2_53:
	r0 = 0;
	r16 = (armory__renderpath__$Inc)g$_armory_renderpath_Inc;
	r5 = r16->spotIndex;
	label$d589772_2_56:
	if( r0 >= r5 ) goto label$d589772_2_73;
	r6 = r0;
	++r0;
	r11 = (String)s$shadowMapSpot_;
	r17 = r6;
	r18 = &r17;
	r19 = hl_itos(r17,r18);
	r14 = String___alloc__(r19,r17);
	r11 = String___add__(r11,r14);
	r14 = (String)s$0fbd177;
	r11 = String___add__(r11,r14);
	r16 = (armory__renderpath__$Inc)g$_armory_renderpath_Inc;
	r15 = r16->path;
	if( r15 == NULL ) hl_null_access();
	iron_RenderPath_bindTarget(r15,r11,r11);
	goto label$d589772_2_56;
	label$d589772_2_73:
	return;
}

String armory_renderpath_Inc_shadowMapName(iron__object__LightObject r0) {
	String r1, r10;
	iron__data__TLightData r2;
	iron__data__LightData r3;
	int *r9;
	armory__renderpath__$Inc r8;
	vbyte *r6, *r7;
	int r4, r5;
	if( r0 == NULL ) hl_null_access();
	r3 = r0->data;
	if( r3 == NULL ) hl_null_access();
	r2 = r3->raw;
	if( r2 == NULL ) hl_null_access();
	r1 = r2->type;
	if( !r1 ) goto label$d589772_3_15;
	r4 = r1->length;
	r5 = 5;
	if( r4 != r5 ) goto label$d589772_3_15;
	r6 = r1->bytes;
	r7 = (vbyte*)USTR("point");
	r4 = hl_string_compare(r6,r7,r4);
	r5 = 0;
	if( r4 == r5 ) goto label$d589772_3_34;
	label$d589772_3_15:
	if( !r1 ) goto label$d589772_3_24;
	r4 = r1->length;
	r5 = 3;
	if( r4 != r5 ) goto label$d589772_3_24;
	r6 = r1->bytes;
	r7 = (vbyte*)USTR("sun");
	r4 = hl_string_compare(r6,r7,r4);
	r5 = 0;
	if( r4 == r5 ) goto label$d589772_3_44;
	label$d589772_3_24:
	r1 = (String)s$shadowMapSpot_;
	r8 = (armory__renderpath__$Inc)g$_armory_renderpath_Inc;
	r4 = r8->spotIndex;
	r9 = &r4;
	r6 = hl_itos(r4,r9);
	r10 = String___alloc__(r6,r4);
	r1 = String___add__(r1,r10);
	r10 = (String)s$0fbd177;
	r1 = String___add__(r1,r10);
	return r1;
	label$d589772_3_34:
	r1 = (String)s$shadowMapPoint_;
	r8 = (armory__renderpath__$Inc)g$_armory_renderpath_Inc;
	r4 = r8->pointIndex;
	r9 = &r4;
	r6 = hl_itos(r4,r9);
	r10 = String___alloc__(r6,r4);
	r1 = String___add__(r1,r10);
	r10 = (String)s$0fbd177;
	r1 = String___add__(r1,r10);
	return r1;
	label$d589772_3_44:
	r1 = (String)s$shadowMap;
	return r1;
}

String armory_renderpath_Inc_getShadowMap(iron__object__LightObject r0) {
	String r1, r8, r19;
	iron__data__TLightData r12;
	haxe__ds__StringMap r5;
	iron__RenderTargetRaw r16;
	bool r14;
	iron__data__LightData r13;
	iron__RenderTarget r9, r10;
	iron__object__LightObject r2;
	vdynamic *r4, *r11, *r15, *r17, *r20;
	iron__object__$LightObject r22;
	int r18, r21;
	armory__renderpath__$Inc r7;
	iron__RenderPath r6;
	r1 = armory_renderpath_Inc_shadowMapName(r0);
	r7 = (armory__renderpath__$Inc)g$_armory_renderpath_Inc;
	r6 = r7->path;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->renderTargets;
	if( r5 == NULL ) hl_null_access();
	r4 = haxe_ds_StringMap_get(r5,r1);
	r9 = (iron__RenderTarget)r4;
	if( r9 ) goto label$d589772_4_86;
	r7 = (armory__renderpath__$Inc)g$_armory_renderpath_Inc;
	r6 = r7->path;
	if( r6 == NULL ) hl_null_access();
	r2 = r6->light;
	if( r2 == NULL ) hl_null_access();
	r13 = r2->data;
	if( r13 == NULL ) hl_null_access();
	r12 = r13->raw;
	if( r12 == NULL ) hl_null_access();
	r11 = r12->shadowmap_cube;
	r14 = r11 ? r11->v.b : 0;
	if( !r14 ) goto label$d589772_4_48;
	r7 = (armory__renderpath__$Inc)g$_armory_renderpath_Inc;
	r6 = r7->path;
	if( r6 == NULL ) hl_null_access();
	r2 = r6->light;
	if( r2 == NULL ) hl_null_access();
	r13 = r2->data;
	if( r13 == NULL ) hl_null_access();
	r12 = r13->raw;
	if( r12 == NULL ) hl_null_access();
	r15 = r12->shadowmap_size;
	r16 = (iron__RenderTargetRaw)hl_alloc_obj(&t$iron_RenderTargetRaw);
	iron_RenderTargetRaw_new(r16);
	r16->name = r1;
	r18 = r15 ? r15->v.i : 0;
	r16->width = r18;
	r18 = r15 ? r15->v.i : 0;
	r16->height = r18;
	r8 = (String)s$DEPTH16;
	r16->format = r8;
	r14 = true;
	r11 = hl_alloc_dynbool(r14);
	r16->is_cubemap = r11;
	r7 = (armory__renderpath__$Inc)g$_armory_renderpath_Inc;
	r6 = r7->path;
	if( r6 == NULL ) hl_null_access();
	r10 = iron_RenderPath_createRenderTarget(r6,r16);
	goto label$d589772_4_86;
	label$d589772_4_48:
	r7 = (armory__renderpath__$Inc)g$_armory_renderpath_Inc;
	r6 = r7->path;
	if( r6 == NULL ) hl_null_access();
	r2 = r6->light;
	if( r2 == NULL ) hl_null_access();
	r13 = r2->data;
	if( r13 == NULL ) hl_null_access();
	r12 = r13->raw;
	if( r12 == NULL ) hl_null_access();
	r15 = r12->shadowmap_size;
	r17 = r15;
	if( r0 == NULL ) hl_null_access();
	r13 = r0->data;
	if( r13 == NULL ) hl_null_access();
	r12 = r13->raw;
	if( r12 == NULL ) hl_null_access();
	r8 = r12->type;
	r19 = (String)s$sun;
	if( r8 != r19 && (!r8 || !r19 || String___compare(r8,(vdynamic*)r19) != 0) ) goto label$d589772_4_73;
	r18 = r15 ? r15->v.i : 0;
	r22 = (iron__object__$LightObject)g$_iron_object_LightObject;
	r21 = r22->cascadeCount;
	r18 = r18 * r21;
	r20 = hl_alloc_dynamic(&t$_i32);
	r20->v.i = r18;
	r15 = r20;
	label$d589772_4_73:
	r16 = (iron__RenderTargetRaw)hl_alloc_obj(&t$iron_RenderTargetRaw);
	iron_RenderTargetRaw_new(r16);
	r16->name = r1;
	r18 = r15 ? r15->v.i : 0;
	r16->width = r18;
	r18 = r17 ? r17->v.i : 0;
	r16->height = r18;
	r8 = (String)s$DEPTH16;
	r16->format = r8;
	r7 = (armory__renderpath__$Inc)g$_armory_renderpath_Inc;
	r6 = r7->path;
	if( r6 == NULL ) hl_null_access();
	r10 = iron_RenderPath_createRenderTarget(r6,r16);
	label$d589772_4_86:
	return r1;
}

void armory_renderpath_Inc_drawShadowMap() {
	String r14, r21, r26;
	iron__data__TLightData r16;
	hl__types__ArrayObj r3, r8;
	bool r12;
	iron__$Scene r5;
	iron__Scene r4;
	iron__data__LightData r17;
	iron__object__LightObject r9;
	double r24;
	double *r22;
	vdynamic *r10, *r15, *r23, *r25;
	iron__RenderPath r13;
	varray *r11;
	armory__renderpath__$Inc r1;
	int r0, r6, r7, r18, r19, r20;
	r0 = 0;
	r1 = (armory__renderpath__$Inc)g$_armory_renderpath_Inc;
	r1->pointIndex = r0;
	r0 = 0;
	r1 = (armory__renderpath__$Inc)g$_armory_renderpath_Inc;
	r1->spotIndex = r0;
	r0 = 0;
	r5 = (iron__$Scene)g$_iron_Scene;
	r4 = r5->active;
	if( r4 == NULL ) hl_null_access();
	r3 = r4->lights;
	label$d589772_5_11:
	if( r3 == NULL ) hl_null_access();
	r7 = r3->length;
	if( r0 >= r7 ) goto label$d589772_5_118;
	r7 = r3->length;
	if( ((unsigned)r0) < ((unsigned)r7) ) goto label$d589772_5_19;
	r9 = NULL;
	goto label$d589772_5_22;
	label$d589772_5_19:
	r11 = r3->array;
	r10 = ((vdynamic**)(r11 + 1))[r0];
	r9 = (iron__object__LightObject)r10;
	label$d589772_5_22:
	++r0;
	if( r9 == NULL ) hl_null_access();
	r12 = r9->visible;
	if( r12 ) goto label$d589772_5_27;
	goto label$d589772_5_11;
	label$d589772_5_27:
	r1 = (armory__renderpath__$Inc)g$_armory_renderpath_Inc;
	r13 = r1->path;
	if( r13 == NULL ) hl_null_access();
	r13->light = r9;
	r14 = armory_renderpath_Inc_getShadowMap(r9);
	r17 = r9->data;
	if( r17 == NULL ) hl_null_access();
	r16 = r17->raw;
	if( r16 == NULL ) hl_null_access();
	r15 = r16->shadowmap_cube;
	r12 = r15 ? r15->v.b : 0;
	if( !r12 ) goto label$d589772_5_41;
	r6 = 6;
	goto label$d589772_5_42;
	label$d589772_5_41:
	r6 = 1;
	label$d589772_5_42:
	r7 = 0;
	r18 = r6;
	label$d589772_5_44:
	if( r7 >= r18 ) goto label$d589772_5_81;
	r19 = r7;
	++r7;
	r20 = 1;
	if( r20 >= r6 ) goto label$d589772_5_54;
	r1 = (armory__renderpath__$Inc)g$_armory_renderpath_Inc;
	r13 = r1->path;
	if( r13 == NULL ) hl_null_access();
	r13->currentFace = r19;
	label$d589772_5_54:
	r1 = (armory__renderpath__$Inc)g$_armory_renderpath_Inc;
	r13 = r1->path;
	if( r13 == NULL ) hl_null_access();
	r8 = NULL;
	r22 = NULL;
	iron_RenderPath_setTarget(r13,r14,r8,r22);
	r1 = (armory__renderpath__$Inc)g$_armory_renderpath_Inc;
	r13 = r1->path;
	if( r13 == NULL ) hl_null_access();
	r23 = NULL;
	r24 = 1.;
	r25 = hl_alloc_dynamic(&t$_f64);
	r25->v.d = r24;
	iron_RenderPath_clearTarget(r13,r23,r25);
	if( r9 == NULL ) hl_null_access();
	r17 = r9->data;
	if( r17 == NULL ) hl_null_access();
	r16 = r17->raw;
	if( r16 == NULL ) hl_null_access();
	r15 = r16->cast_shadow;
	r12 = r15 ? r15->v.b : 0;
	if( !r12 ) goto label$d589772_5_80;
	r1 = (armory__renderpath__$Inc)g$_armory_renderpath_Inc;
	r13 = r1->path;
	if( r13 == NULL ) hl_null_access();
	r21 = (String)s$shadowmap;
	iron_RenderPath_drawMeshes(r13,r21);
	label$d589772_5_80:
	goto label$d589772_5_44;
	label$d589772_5_81:
	r1 = (armory__renderpath__$Inc)g$_armory_renderpath_Inc;
	r13 = r1->path;
	if( r13 == NULL ) hl_null_access();
	r7 = -1;
	r13->currentFace = r7;
	if( r9 == NULL ) hl_null_access();
	r17 = r9->data;
	if( r17 == NULL ) hl_null_access();
	r16 = r17->raw;
	if( r16 == NULL ) hl_null_access();
	r21 = r16->type;
	r26 = (String)s$point;
	if( r21 != r26 && (!r21 || !r26 || String___compare(r21,(vdynamic*)r26) != 0) ) goto label$d589772_5_99;
	r1 = (armory__renderpath__$Inc)g$_armory_renderpath_Inc;
	r7 = r1->pointIndex;
	++r7;
	r1->pointIndex = r7;
	goto label$d589772_5_117;
	label$d589772_5_99:
	r17 = r9->data;
	if( r17 == NULL ) hl_null_access();
	r16 = r17->raw;
	if( r16 == NULL ) hl_null_access();
	r21 = r16->type;
	r26 = (String)s$spot;
	if( r21 == r26 || (r21 && r26 && String___compare(r21,(vdynamic*)r26) == 0) ) goto label$d589772_5_113;
	r17 = r9->data;
	if( r17 == NULL ) hl_null_access();
	r16 = r17->raw;
	if( r16 == NULL ) hl_null_access();
	r21 = r16->type;
	r26 = (String)s$area;
	if( r21 != r26 && (!r21 || !r26 || String___compare(r21,(vdynamic*)r26) != 0) ) goto label$d589772_5_117;
	label$d589772_5_113:
	r1 = (armory__renderpath__$Inc)g$_armory_renderpath_Inc;
	r7 = r1->spotIndex;
	++r7;
	r1->spotIndex = r7;
	label$d589772_5_117:
	goto label$d589772_5_11;
	label$d589772_5_118:
	return;
}


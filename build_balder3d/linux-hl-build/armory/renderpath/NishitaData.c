// Generated by HLC 4.2.5 (HL v4)
#define HLC_BOOT
#include <hlc.h>
#include <armory/renderpath/NishitaData.h>
#include <iron/math/Vec2.h>
extern hl_type t$iron_math_Vec2;
void iron_math_Vec2_new(iron__math__Vec2,float*,float*);
#include <hl/natives.h>
#include <haxe/io/ArrayBufferViewImpl.h>
#include <haxe/io/Bytes.h>
#include <_std/Math.h>
extern armory__renderpath__$NishitaData g$_armory_renderpath_NishitaData;
extern hl_type t$haxe_io_ArrayBufferViewImpl;
haxe__io__Bytes haxe_io_Bytes_alloc(int);
void haxe_io_ArrayBufferViewImpl_new(haxe__io__ArrayBufferViewImpl,haxe__io__Bytes,int,int);
extern $Math g$_Math;
iron__math__Vec3 armory_renderpath_NishitaData_sampleSecondaryRay(armory__renderpath__NishitaData,float,float,iron__math__Vec3);
void haxe_io_Bytes_setFloat(haxe__io__Bytes,int,double);
extern hl_type t$_i32;
kha__Image kha_Image_fromBytes(haxe__io__Bytes,int,int,vdynamic*,vdynamic*,bool*);
extern hl_type t$iron_math_Vec3;
void iron_math_Vec3_new(iron__math__Vec3,float*,float*,float*);

void armory_renderpath_NishitaData_new(armory__renderpath__NishitaData r0) {
	return;
}

float armory_renderpath_NishitaData_getOzoneDensity(armory__renderpath__NishitaData r0,float r1) {
	float r2;
	double r3, r4;
	r3 = (double)r1;
	r4 = 10000.;
	if( r3 < r4 ) goto label$7793b3e_2_6;
	r3 = (double)r1;
	r4 = 40000.;
	if( !(r3 >= r4) ) goto label$7793b3e_2_9;
	label$7793b3e_2_6:
	r3 = 0.;
	r2 = (float)r3;
	return r2;
	label$7793b3e_2_9:
	r3 = (double)r1;
	r4 = 25000.;
	if( !(r3 < r4) ) goto label$7793b3e_2_19;
	r3 = (double)r1;
	r4 = 10000.;
	r3 = r3 - r4;
	r4 = 15000.;
	r3 = r3 / r4;
	r2 = (float)r3;
	return r2;
	label$7793b3e_2_19:
	r3 = (double)r1;
	r4 = 40000.;
	r3 = r3 - r4;
	r4 = 15000.;
	r3 = r3 / r4;
	r3 = -r3;
	r2 = (float)r3;
	return r2;
}

iron__math__Vec2 armory_renderpath_NishitaData_raySphereIntersection(armory__renderpath__NishitaData r0,iron__math__Vec3 r1,iron__math__Vec3 r2,double r3) {
	iron__math__Vec2 r14;
	float r4, r5, r6, r9, r18;
	double r8, r10, r11, r12, r13, r17;
	float *r15, *r16;
	if( r2 == NULL ) hl_null_access();
	r4 = r2->x;
	r5 = r2->x;
	r4 = r4 * r5;
	r5 = r2->y;
	r6 = r2->y;
	r5 = r5 * r6;
	r4 = r4 + r5;
	r5 = r2->z;
	r6 = r2->z;
	r5 = r5 * r6;
	r4 = r4 + r5;
	r8 = 2.;
	r5 = r2->x;
	if( r1 == NULL ) hl_null_access();
	r6 = r1->x;
	r5 = r5 * r6;
	r6 = r2->y;
	r9 = r1->y;
	r6 = r6 * r9;
	r5 = r5 + r6;
	r6 = r2->z;
	r9 = r1->z;
	r6 = r6 * r9;
	r5 = r5 + r6;
	r10 = (double)r5;
	r8 = r8 * r10;
	r5 = r1->x;
	r6 = r1->x;
	r5 = r5 * r6;
	r6 = r1->y;
	r9 = r1->y;
	r6 = r6 * r9;
	r5 = r5 + r6;
	r6 = r1->z;
	r9 = r1->z;
	r6 = r6 * r9;
	r5 = r5 + r6;
	r10 = (double)r5;
	r11 = r3 * r3;
	r10 = r10 - r11;
	r11 = r8 * r8;
	r12 = 4.;
	r13 = (double)r4;
	r12 = r12 * r13;
	r12 = r12 * r10;
	r11 = r11 - r12;
	r13 = 0.;
	if( !(r11 < r13) ) goto label$7793b3e_3_58;
	r14 = (iron__math__Vec2)hl_alloc_obj(&t$iron_math_Vec2);
	r12 = 100000.;
	r5 = (float)r12;
	r15 = &r5;
	r12 = -100000.;
	r6 = (float)r12;
	r16 = &r6;
	iron_math_Vec2_new(r14,r15,r16);
	return r14;
	label$7793b3e_3_58:
	r14 = (iron__math__Vec2)hl_alloc_obj(&t$iron_math_Vec2);
	r12 = -r8;
	r13 = hl_math_sqrt(r11);
	r12 = r12 - r13;
	r13 = 2.;
	r17 = (double)r4;
	r13 = r13 * r17;
	r12 = r12 / r13;
	r9 = (float)r12;
	r15 = &r9;
	r12 = -r8;
	r13 = hl_math_sqrt(r11);
	r12 = r12 + r13;
	r13 = 2.;
	r17 = (double)r4;
	r13 = r13 * r17;
	r12 = r12 / r13;
	r18 = (float)r12;
	r16 = &r18;
	iron_math_Vec2_new(r14,r15,r16);
	return r14;
}

void armory_renderpath_NishitaData_computeLUT(armory__renderpath__NishitaData r0,iron__math__Vec3 r1) {
	bool *r31;
	kha__Image r28;
	iron__math__Vec3 r22;
	haxe__io__Bytes r7;
	$Math r20;
	haxe__io__ArrayBufferViewImpl r6, r9;
	float r23, r24;
	double r12, r14, r15, r16, r21;
	armory__renderpath__$NishitaData r3;
	vdynamic *r29, *r30;
	int r2, r4, r8, r10, r11, r13, r17, r18, r19, r25, r26, r27;
	r3 = (armory__renderpath__$NishitaData)g$_armory_renderpath_NishitaData;
	r2 = r3->lutHeightSteps;
	r3 = (armory__renderpath__$NishitaData)g$_armory_renderpath_NishitaData;
	r4 = r3->lutAngleSteps;
	r2 = r2 * r4;
	r4 = 4;
	r2 = r2 * r4;
	r4 = 4;
	r2 = r2 * r4;
	r6 = (haxe__io__ArrayBufferViewImpl)hl_alloc_obj(&t$haxe_io_ArrayBufferViewImpl);
	r7 = haxe_io_Bytes_alloc(r2);
	r4 = 0;
	haxe_io_ArrayBufferViewImpl_new(r6,r7,r4,r2);
	r9 = r6;
	r4 = 0;
	r3 = (armory__renderpath__$NishitaData)g$_armory_renderpath_NishitaData;
	r8 = r3->lutHeightSteps;
	label$7793b3e_4_17:
	if( r4 >= r8 ) goto label$7793b3e_4_156;
	r10 = r4;
	++r4;
	r12 = (double)r10;
	r3 = (armory__renderpath__$NishitaData)g$_armory_renderpath_NishitaData;
	r11 = r3->lutHeightSteps;
	r13 = 1;
	r11 = r11 - r13;
	r14 = (double)r11;
	r12 = r12 / r14;
	r14 = r12 * r12;
	r3 = (armory__renderpath__$NishitaData)g$_armory_renderpath_NishitaData;
	r15 = r3->radiusAtmo;
	r16 = 1000.;
	r15 = r15 * r16;
	r14 = r14 * r15;
	r12 = r14;
	r11 = 0;
	r3 = (armory__renderpath__$NishitaData)g$_armory_renderpath_NishitaData;
	r13 = r3->lutAngleSteps;
	label$7793b3e_4_38:
	if( r11 >= r13 ) goto label$7793b3e_4_155;
	r17 = r11;
	++r11;
	r14 = (double)r17;
	r3 = (armory__renderpath__$NishitaData)g$_armory_renderpath_NishitaData;
	r18 = r3->lutAngleSteps;
	r19 = 1;
	r18 = r18 - r19;
	r15 = (double)r18;
	r14 = r14 / r15;
	r15 = 2.;
	r14 = r14 * r15;
	r15 = 1.;
	r14 = r14 - r15;
	r16 = 0.;
	if( r14 != r16 ) goto label$7793b3e_4_57;
	r15 = 0.;
	goto label$7793b3e_4_62;
	label$7793b3e_4_57:
	r16 = 0.;
	if( !(r14 < r16) ) goto label$7793b3e_4_61;
	r15 = -1.;
	goto label$7793b3e_4_62;
	label$7793b3e_4_61:
	r15 = 1.;
	label$7793b3e_4_62:
	r15 = r15 * r14;
	r15 = r15 * r14;
	r20 = ($Math)g$_Math;
	r16 = r20->PI;
	r15 = r15 * r16;
	r16 = 2.;
	r15 = r15 / r16;
	r20 = ($Math)g$_Math;
	r16 = r20->PI;
	r21 = 2.;
	r16 = r16 / r21;
	r15 = r15 + r16;
	r14 = r15;
	r23 = (float)r12;
	r24 = (float)r14;
	r22 = armory_renderpath_NishitaData_sampleSecondaryRay(r0,r23,r24,r1);
	r3 = (armory__renderpath__$NishitaData)g$_armory_renderpath_NishitaData;
	r25 = r3->lutHeightSteps;
	r19 = r17 * r25;
	r18 = r10 + r19;
	r19 = 4;
	r18 = r18 * r19;
	if( r22 == NULL ) hl_null_access();
	r23 = r22->x;
	r15 = (double)r23;
	r25 = 0;
	if( r18 < r25 ) goto label$7793b3e_4_101;
	if( r9 == NULL ) hl_null_access();
	r25 = r9->byteLength;
	r26 = 2;
	r25 = r25 >> r26;
	if( r18 >= r25 ) goto label$7793b3e_4_101;
	r7 = r9->bytes;
	if( r7 == NULL ) hl_null_access();
	r25 = 2;
	r19 = r18 << r25;
	r25 = r9->byteOffset;
	r19 = r19 + r25;
	haxe_io_Bytes_setFloat(r7,r19,r15);
	label$7793b3e_4_101:
	r25 = 1;
	r19 = r18 + r25;
	r23 = r22->y;
	r15 = (double)r23;
	r26 = 0;
	if( r19 < r26 ) goto label$7793b3e_4_119;
	if( r9 == NULL ) hl_null_access();
	r26 = r9->byteLength;
	r27 = 2;
	r26 = r26 >> r27;
	if( r19 >= r26 ) goto label$7793b3e_4_119;
	r7 = r9->bytes;
	if( r7 == NULL ) hl_null_access();
	r26 = 2;
	r25 = r19 << r26;
	r26 = r9->byteOffset;
	r25 = r25 + r26;
	haxe_io_Bytes_setFloat(r7,r25,r15);
	label$7793b3e_4_119:
	r25 = 2;
	r19 = r18 + r25;
	r23 = r22->z;
	r15 = (double)r23;
	r26 = 0;
	if( r19 < r26 ) goto label$7793b3e_4_137;
	if( r9 == NULL ) hl_null_access();
	r26 = r9->byteLength;
	r27 = 2;
	r26 = r26 >> r27;
	if( r19 >= r26 ) goto label$7793b3e_4_137;
	r7 = r9->bytes;
	if( r7 == NULL ) hl_null_access();
	r26 = 2;
	r25 = r19 << r26;
	r26 = r9->byteOffset;
	r25 = r25 + r26;
	haxe_io_Bytes_setFloat(r7,r25,r15);
	label$7793b3e_4_137:
	r25 = 3;
	r19 = r18 + r25;
	r26 = 0;
	if( r19 < r26 ) goto label$7793b3e_4_154;
	if( r9 == NULL ) hl_null_access();
	r26 = r9->byteLength;
	r27 = 2;
	r26 = r26 >> r27;
	if( r19 >= r26 ) goto label$7793b3e_4_154;
	r7 = r9->bytes;
	if( r7 == NULL ) hl_null_access();
	r26 = 2;
	r25 = r19 << r26;
	r26 = r9->byteOffset;
	r25 = r25 + r26;
	r15 = 1.;
	haxe_io_Bytes_setFloat(r7,r25,r15);
	label$7793b3e_4_154:
	goto label$7793b3e_4_38;
	label$7793b3e_4_155:
	goto label$7793b3e_4_17;
	label$7793b3e_4_156:
	if( r9 == NULL ) hl_null_access();
	r7 = r9->bytes;
	r3 = (armory__renderpath__$NishitaData)g$_armory_renderpath_NishitaData;
	r4 = r3->lutHeightSteps;
	r3 = (armory__renderpath__$NishitaData)g$_armory_renderpath_NishitaData;
	r8 = r3->lutAngleSteps;
	r10 = 2;
	r29 = hl_alloc_dynamic(&t$_i32);
	r29->v.i = r10;
	r10 = 0;
	r30 = hl_alloc_dynamic(&t$_i32);
	r30->v.i = r10;
	r31 = NULL;
	r28 = kha_Image_fromBytes(r7,r4,r8,r29,r30,r31);
	r0->lut = r28;
	return;
}

iron__math__Vec3 armory_renderpath_NishitaData_sampleSecondaryRay(armory__renderpath__NishitaData r0,float r1,float r2,iron__math__Vec3 r3) {
	iron__math__Vec3 r13, r21, r24, r27, r31;
	iron__math__Vec2 r30;
	float r9, r10, r11, r14, r16, r18, r20, r22, r23, r25, r26, r28, r29, r32, r33, r35, r36, r37, r38, r39, r40, r41, r43, r44, r45;
	armory__renderpath__$NishitaData r5;
	double r4, r6, r12, r42, r46;
	float *r15, *r17, *r19;
	int r8, r34;
	r5 = (armory__renderpath__$NishitaData)g$_armory_renderpath_NishitaData;
	r4 = r5->radiusPlanet;
	r6 = 1000.;
	r4 = r4 * r6;
	r8 = 0;
	r9 = (float)r8;
	r8 = 0;
	r10 = (float)r8;
	r6 = (double)r1;
	r6 = r6 + r4;
	r11 = (float)r6;
	r13 = (iron__math__Vec3)hl_alloc_obj(&t$iron_math_Vec3);
	r6 = 0.;
	r14 = (float)r6;
	r15 = &r14;
	r6 = (double)r2;
	r6 = hl_math_sin(r6);
	r16 = (float)r6;
	r17 = &r16;
	r6 = (double)r2;
	r6 = hl_math_cos(r6);
	r18 = (float)r6;
	r19 = &r18;
	iron_math_Vec3_new(r13,r15,r17,r19);
	r20 = r13->x;
	r22 = r13->x;
	r20 = r20 * r22;
	r22 = r13->y;
	r23 = r13->y;
	r22 = r22 * r23;
	r20 = r20 + r22;
	r22 = r13->z;
	r23 = r13->z;
	r22 = r22 * r23;
	r20 = r20 + r22;
	r6 = (double)r20;
	r6 = hl_math_sqrt(r6);
	r20 = (float)r6;
	r6 = (double)r20;
	r12 = 0.;
	if( !(r12 < r6) ) goto label$7793b3e_5_56;
	r6 = 1.;
	r12 = (double)r20;
	r6 = r6 / r12;
	r22 = r13->x;
	r23 = (float)r6;
	r22 = r22 * r23;
	r13->x = r22;
	r22 = r13->y;
	r23 = (float)r6;
	r22 = r22 * r23;
	r13->y = r22;
	r22 = r13->z;
	r23 = (float)r6;
	r22 = r22 * r23;
	r13->z = r22;
	label$7793b3e_5_56:
	r21 = r13;
	r6 = 0.;
	r22 = (float)r6;
	r24 = (iron__math__Vec3)hl_alloc_obj(&t$iron_math_Vec3);
	r23 = r9;
	r15 = &r23;
	r25 = r10;
	r17 = &r25;
	r26 = r11;
	r19 = &r26;
	iron_math_Vec3_new(r24,r15,r17,r19);
	r28 = r24->x;
	r6 = 0.001000000000000000021;
	r29 = (float)r6;
	r28 = r28 * r29;
	r24->x = r28;
	r28 = r24->y;
	r6 = 0.001000000000000000021;
	r29 = (float)r6;
	r28 = r28 * r29;
	r24->y = r28;
	r28 = r24->z;
	r6 = 0.001000000000000000021;
	r29 = (float)r6;
	r28 = r28 * r29;
	r24->z = r28;
	r5 = (armory__renderpath__$NishitaData)g$_armory_renderpath_NishitaData;
	r6 = r5->radiusAtmo;
	r30 = armory_renderpath_NishitaData_raySphereIntersection(r0,r24,r13,r6);
	if( r30 == NULL ) hl_null_access();
	r28 = r30->y;
	r6 = (double)r28;
	r5 = (armory__renderpath__$NishitaData)g$_armory_renderpath_NishitaData;
	r8 = r5->jSteps;
	r12 = (double)r8;
	r6 = r6 / r12;
	r28 = (float)r6;
	r8 = 1000;
	r32 = (float)r8;
	r29 = r28 * r32;
	r28 = r29;
	r6 = 0.;
	r29 = (float)r6;
	r6 = 0.;
	r32 = (float)r6;
	r6 = 0.;
	r33 = (float)r6;
	r8 = 0;
	r5 = (armory__renderpath__$NishitaData)g$_armory_renderpath_NishitaData;
	r34 = r5->jSteps;
	label$7793b3e_5_106:
	if( r8 >= r34 ) goto label$7793b3e_5_173;
	++r8;
	if( r21 == NULL ) hl_null_access();
	r38 = r21->x;
	r39 = r21->y;
	r40 = r21->z;
	r6 = (double)r22;
	r12 = (double)r28;
	r42 = 0.5;
	r12 = r12 * r42;
	r6 = r6 + r12;
	r41 = (float)r6;
	r43 = r38 * r41;
	r38 = r43;
	r43 = r39 * r41;
	r39 = r43;
	r43 = r40 * r41;
	r40 = r43;
	r43 = r9 + r38;
	r35 = r43;
	r43 = r10 + r39;
	r36 = r43;
	r43 = r11 + r40;
	r37 = r43;
	r43 = r35 * r35;
	r44 = r36 * r36;
	r43 = r43 + r44;
	r44 = r37 * r37;
	r43 = r43 + r44;
	r6 = (double)r43;
	r6 = hl_math_sqrt(r6);
	r43 = (float)r6;
	r6 = (double)r43;
	r6 = r6 - r4;
	r12 = -r6;
	r5 = (armory__renderpath__$NishitaData)g$_armory_renderpath_NishitaData;
	r42 = r5->rayleighScale;
	r12 = r12 / r42;
	r12 = hl_math_exp(r12);
	if( r3 == NULL ) hl_null_access();
	r43 = r3->x;
	r42 = (double)r43;
	r12 = r12 * r42;
	r42 = -r6;
	r5 = (armory__renderpath__$NishitaData)g$_armory_renderpath_NishitaData;
	r46 = r5->mieScale;
	r42 = r42 / r46;
	r42 = hl_math_exp(r42);
	r43 = r3->y;
	r46 = (double)r43;
	r42 = r42 * r46;
	r43 = (float)r6;
	r43 = armory_renderpath_NishitaData_getOzoneDensity(r0,r43);
	r44 = r3->z;
	r43 = r43 * r44;
	r45 = (float)r12;
	r44 = r29 + r45;
	r29 = r44;
	r45 = (float)r42;
	r44 = r32 + r45;
	r32 = r44;
	r44 = r33 + r43;
	r33 = r44;
	r44 = r22 + r28;
	r22 = r44;
	goto label$7793b3e_5_106;
	label$7793b3e_5_173:
	r35 = r29 * r28;
	r29 = r35;
	r35 = r32 * r28;
	r32 = r35;
	r35 = r33 * r28;
	r33 = r35;
	r27 = (iron__math__Vec3)hl_alloc_obj(&t$iron_math_Vec3);
	r15 = NULL;
	r17 = NULL;
	r19 = NULL;
	iron_math_Vec3_new(r27,r15,r17,r19);
	r5 = (armory__renderpath__$NishitaData)g$_armory_renderpath_NishitaData;
	r6 = r5->mieCoeff;
	r12 = (double)r32;
	r6 = r6 * r12;
	r35 = r27->x;
	r36 = (float)r6;
	r35 = r35 + r36;
	r27->x = r35;
	r35 = r27->y;
	r36 = (float)r6;
	r35 = r35 + r36;
	r27->y = r35;
	r35 = r27->z;
	r36 = (float)r6;
	r35 = r35 + r36;
	r27->z = r35;
	r5 = (armory__renderpath__$NishitaData)g$_armory_renderpath_NishitaData;
	r31 = r5->rayleighCoeff;
	if( r31 == NULL ) hl_null_access();
	r35 = r31->x;
	r36 = r31->y;
	r37 = r31->z;
	r39 = r35 * r29;
	r35 = r39;
	r39 = r36 * r29;
	r36 = r39;
	r39 = r37 * r29;
	r37 = r39;
	r39 = r27->x;
	r39 = r39 + r35;
	r27->x = r39;
	r39 = r27->y;
	r39 = r39 + r36;
	r27->y = r39;
	r39 = r27->z;
	r39 = r39 + r37;
	r27->z = r39;
	r5 = (armory__renderpath__$NishitaData)g$_armory_renderpath_NishitaData;
	r31 = r5->ozoneCoeff;
	if( r31 == NULL ) hl_null_access();
	r35 = r31->x;
	r36 = r31->y;
	r37 = r31->z;
	r39 = r35 * r33;
	r35 = r39;
	r39 = r36 * r33;
	r36 = r39;
	r39 = r37 * r33;
	r37 = r39;
	r39 = r27->x;
	r39 = r39 + r35;
	r27->x = r39;
	r39 = r27->y;
	r39 = r39 + r36;
	r27->y = r39;
	r39 = r27->z;
	r39 = r39 + r37;
	r27->z = r39;
	r35 = r27->x;
	r8 = -1;
	r36 = (float)r8;
	r35 = r35 * r36;
	r27->x = r35;
	r35 = r27->y;
	r8 = -1;
	r36 = (float)r8;
	r35 = r35 * r36;
	r27->y = r35;
	r35 = r27->z;
	r8 = -1;
	r36 = (float)r8;
	r35 = r35 * r36;
	r27->z = r35;
	r35 = r27->x;
	r12 = (double)r35;
	r12 = hl_math_exp(r12);
	r35 = (float)r12;
	r27->x = r35;
	r35 = r27->y;
	r12 = (double)r35;
	r12 = hl_math_exp(r12);
	r35 = (float)r12;
	r27->y = r35;
	r35 = r27->z;
	r12 = (double)r35;
	r12 = hl_math_exp(r12);
	r35 = (float)r12;
	r27->z = r35;
	return r27;
}

